<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Val-Stats: Personal Contribution Tracker</title>
<script type="module">
import{initializeApp as t}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import{getAuth as e,signInWithPopup as a,GoogleAuthProvider as i,signOut as n,onAuthStateChanged as s}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";import{getFirestore as o,doc as r,collection as d,query as l,onSnapshot as c,where as m,getDocs as u,writeBatch as p}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";const h={apiKey:"AIzaSyC4CEh7zUm8QbMZzrNMaC_jEhHioyMhksI",authDomain:"val-stats-6e421.firebaseapp.com",projectId:"val-stats-6e421",storageBucket:"val-stats-6e421.firebasestorage.app",messagingSenderId:"1054962717828",appId:"1:1054962717828:web:df1b68c6d2b8d14bc41ed1",measurementId:"G-PS5RK92NV9"},g=t(h),f=e(g),y=o(g),v=new i,b="val-stats-tracker";window.db=y,window.auth=f,window.appId=b,window.dataLoaded=!1,window.aggregatedData={},window.githubData={},window.getPaths=t=>({userEntriesCollection:`artifacts/${b}/users/${t}/entries`,publicStatsCollection:`artifacts/${b}/public/data/daily_stats`}),window.dateToDays=t=>{const e=new Date(t),a=new Date("1970-01-01");return Math.floor((e-a)/864e5)},window.getTodayDate=()=>(new Date).toISOString().slice(0,10),window.handleSignIn=async()=>{try{const t=await a(f,v);console.log("Signed in successfully:",t.user.uid)}catch(t){console.error("Google Sign-In Error:",t.message),window.showToast("Sign-In failed.","error")}},window.handleSignOut=()=>{n(f).then(()=>{console.log("Signed out."),window.showToast("Signed out successfully.","success")}).catch(t=>{console.error("Sign-Out Error:",t)})};const w=(t,e)=>{if("github"===e){if(t>=10)return 4;if(t>=5)return 3;if(t>=2)return 2;if(t>=1)return 1;return 0}if("movie"===e){if(t>=120)return 4;if(t>=60)return 3;if(t>=30)return 2;if(t>0)return 1;return 0}let a=[15,30,45,60];return t>=a[3]?4:t>=a[2]?3:t>=a[1]?2:t>=a[0]?1:0},D=t=>{const e=new Date(2025,0,1),a=new Date(e);a.setDate(e.getDate()-e.getDay());const i={["grid-container-1"]:{type:"github",label:"GitHub Contributions"},["grid-container-3"]:{type:"movie",label:"Movies Watched in Minutes"},["grid-container-2"]:{type:"book",label:"Books in Time Minutes"}};Object.keys(i).forEach(e=>{const{type:n}=i[e],s=document.getElementById(e);if(!s)return;s.innerHTML="";for(let e=0;e<53;e++)for(let i=0;i<7;i++){const o=new Date(a);o.setDate(a.getDate()+7*e+i);const r=o.getFullYear(),d=o.toISOString().slice(0,10);if(2025!==r){const t=document.createElement("div");t.className="grid-cell cell-0",s.appendChild(t);continue}const l=t[d];let c=0,m=d+"\nActivity: 0";if("github"===n){const t=window.githubData[d]||0;c=w(t,"github"),m=`${d}\nGitHub Contributions: ${t}`}else if(l){const t=l[n]||0;c=w(t,n),m=`${d}\n${n.charAt(0).toUpperCase()+n.slice(1)} Time: ${t} mins`,"movie"===n&&l.movieDetails&&(m+=`\nDetails: ${l.movieDetails}`)}const u=document.createElement("div");u.className=`grid-cell cell-${c}`,u.title=m,u.setAttribute("data-date",d),u.style.cursor="pointer",u.onclick=()=>window.showDayDetails(d),s.appendChild(u)}})};window.loadGithubData=async()=>{try{const t=await fetch("github.json");if(!t.ok)return void console.warn("github.json not found");const e=await t.json();if(!Array.isArray(e))return void console.warn("Invalid github.json format");const a={};e.forEach(t=>{t.date&&t.value&&(a[t.date]=t.value)}),window.githubData=a,D(window.aggregatedData)}catch(t){console.warn("Failed to load github.json:",t)}},window.setupPublicListener=()=>{const t=d(y,`artifacts/${b}/public/data/daily_stats`);c(t,t=>{const e={};t.forEach(t=>{const a=t.data();e[a.date]=a}),window.aggregatedData=e,window.dataLoaded=!0,D(window.aggregatedData),Object.keys(e).length>0&&window.showToast("Stats loaded!","success")},t=>{console.error("Error listening to public stats:",t),window.showToast("Failed to load stats.","error")}),window.loadGithubData()},window.handleLetterboxdImport=async()=>{if(!f.currentUser)return void window.showToast("You must be logged in to import data.","error");const t=document.getElementById("letterboxd-file").files[0];if(!t)return void window.showToast("Please select a JSON file.","error");try{const e=await t.text(),a=JSON.parse(e);if(!Array.isArray(a))return void window.showToast("Invalid JSON format.","error");window.showToast(`Processing ${a.length} movies...`,"info");let i=0,n=0;for(const t of a){try{const e=t["Watched Date"];if(!e||!e.startsWith("2025"))continue;const a=t.Duration&&t.Duration.trim()!==""?parseInt(t.Duration):1,s={type:"movie",title:t.Name||"Unknown",duration:a,date:e,timestamp:new Date,rating:t.Rating||null,director:t.Director&&t.Director.trim()!==""?t.Director:"N/A",letterboxdId:t["Letterboxd ID"]||null,watchedInTheater:"üìΩÔ∏è"===t.Where,watchedWithPeople:"üë•"===t.With,year:t.Year||null,rewatch:t.Rewatch&&t.Rewatch.trim()!==""?!0:!1};await window.saveMovieEntry(s,e),i++}catch(t){console.error("Error importing entry:",t),n++}}window.showToast(`Import complete! ${i} movies added, ${n} failed.`,"success")}catch(t){console.error("Import Error:",t),window.showToast(`Import failed: ${t.message}`,"error")}},window.saveMovieEntry=async(t,e)=>{const a=f.currentUser.uid,{userEntriesCollection:i,publicStatsCollection:n}=window.getPaths(a),s=p(y);try{const a=r(d(y,i));s.set(a,t);const o=r(y,n,e),c=await u(l(d(y,i),m("date","==",e)));let p=0,h=0,g=new Set,v=[];c.forEach(t=>{const e=t.data();"movie"===e.type?(p+=e.duration,e.director&&g.add(e.director),v.push(`[${e.director}] ${e.title} (${e.rating||"N/A"}‚òÖ)`)):"book"===e.type&&(h+=e.duration)}),p+=t.duration,t.director&&g.add(t.director),v.push(`[${t.director||"N/A"}] ${t.title} (${t.rating||"N/A"}‚òÖ)`),s.set(o,{date:e,movie:p,book:h,movies_directors:Array.from(g),movieDetails:v.join(" | ")},{merge:!0}),await s.commit()}catch(t){throw console.error("Save Error:",t),t}},window.handleEntrySubmission=async()=>{if(!f.currentUser)return void window.showToast("You must be logged in to submit data.","error");const t=document.getElementById("entry-type").value,e=document.getElementById("entry-title").value.trim(),a=parseInt(document.getElementById("entry-duration").value),i=document.getElementById("entry-director").value.trim(),n=parseFloat(document.getElementById("entry-rating").value),s=document.getElementById("entry-letterboxd").value.trim(),o=document.getElementById("entry-theater").checked,c=document.getElementById("entry-date").value;if(!e||isNaN(a)||!c)return void window.showToast("Please fill in required fields (Title, Duration, Date).","error");const h={type:t,title:e,duration:a,date:c,timestamp:new Date,rating:isNaN(n)?null:n};"movie"===t&&(h.watchedInTheater=o,h.director=i||"N/A",h.letterboxdId=s||null);const g=f.currentUser.uid,{userEntriesCollection:v,publicStatsCollection:b}=window.getPaths(g),w=p(y);try{const n=r(d(y,v));w.set(n,h);const s=r(y,b,c),o=await u(l(d(y,v),m("date","==",c)));let p=0,g=0,D=new Set,I=[];o.forEach(t=>{const e=t.data();"movie"===e.type?(p+=e.duration,e.director&&D.add(e.director),I.push(`[${e.director}] ${e.title} (${e.rating||"N/A"}‚òÖ)`)):"book"===e.type&&(g+=e.duration)}),"movie"===t?(p+=a,i&&D.add(i),I.push(`[${i||"N/A"}] ${e} (${n||"N/A"}‚òÖ)`)):g+=a,w.set(s,{date:c,movie:p,book:g,movies_directors:Array.from(D),movieDetails:I.join(" | ")},{merge:!0}),await w.commit(),document.getElementById("entry-form").reset(),document.getElementById("entry-date").value=window.getTodayDate(),window.showToast("Entry submitted successfully!","success")}catch(t){console.error("Submission Error:",t),window.showToast(`Submission failed: ${t.message}`,"error")}},window.showDayDetails=async t=>{if(!f.currentUser)return void window.showToast("Sign in to view details.","error");const e=f.currentUser.uid,{userEntriesCollection:a}=window.getPaths(e);try{const e=await u(l(d(y,a),m("date","==",t)));if(e.empty)return void window.showToast("No activity on this date.","info");let i=`<div style="padding:1.5rem;"><h3 style="margin-top:0;color:var(--color-primary);">${t}</h3>`,n=[],s=0,o=0;e.forEach(t=>{const e=t.data();"movie"===e.type?(n.push(e),s+=e.duration):"book"===e.type&&(o+=e.duration)}),n.length>0&&(i+=`<div style="margin-bottom:1rem;"><strong style="color:var(--color-primary);">Movies (${s} mins):</strong><ul style="margin:0.5rem 0;padding-left:0;">`,n.forEach(t=>{let e=`<strong>${t.title}</strong>`;t.year&&(e+=` (${t.year})`),t.rewatch&&(e+=" üîÅ"),e+=`<br><span style="color:#9ca3af;font-size:0.8rem;">`,t.director&&"N/A"!==t.director&&(e+=`üé¨ ${t.director}`),t.rating&&(e+=` ‚Ä¢ ‚≠ê ${t.rating}`),t.duration&&(e+=` ‚Ä¢ ‚è±Ô∏è ${t.duration}min`),t.watchedInTheater&&(e+=" ‚Ä¢ üìΩÔ∏è"),t.watchedWithPeople&&(e+=" ‚Ä¢ üë•"),e+="</span>",i+=`<li style="margin:0.5rem 0;padding:0.75rem;background-color:var(--color-bg-dark);border-radius:0.375rem;border-left:3px solid var(--color-primary);">${e}</li>`}),i+="</ul></div>"),o>0&&(i+=`<div><strong style="color:var(--color-primary);">Books:</strong> ${o} minutes</div>`),i+="</div>";const c=document.getElementById("modal-content");c.innerHTML=`<button class="close-modal" onclick="closeModal()">√ó</button>${i}`,document.getElementById("details-modal").style.display="flex"}catch(t){console.error("Error fetching day details:",t),window.showToast("Failed to load details.","error")}},window.closeModal=()=>{document.getElementById("details-modal").style.display="none"},window.showToast=(t,e="info")=>{const a=document.getElementById("toast-message");a.textContent=t,a.className="toast show "+e,setTimeout(()=>{a.className=a.className.replace("show","")},3e3)},s(f,t=>{const e=document.getElementById("login-section"),a=document.getElementById("data-entry-section"),i=document.getElementById("entry-container"),n=document.getElementById("import-container");t?(e.style.display="none",a.style.display="block",i.style.display="block",n.style.display="block",document.getElementById("user-email").textContent=t.email||t.uid):(e.style.display="block",a.style.display="none",i.style.display="none",n.style.display="none"),window.dataLoaded||window.setupPublicListener()}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("entry-date").value=window.getTodayDate()});
</script>
<style>
:root{--color-cell-0:#161b22;--color-cell-1:#0e4429;--color-cell-2:#006d32;--color-cell-3:#26a641;--color-cell-4:#39d353;--color-bg-dark:#0a0a0a;--color-bg-mid:#1f2937;--color-bg-light:#374151;--color-text:#f3f4f6;--color-primary:#39d353;--color-error:#ef4444;--color-success:#10b981}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background-color:var(--color-bg-dark);color:var(--color-text);margin:0;padding:0;min-height:100vh;display:flex;flex-direction:column;align-items:center}.main-container{width:95%;max-width:1200px;padding:2rem 0}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;padding:0 1rem}.header h1{font-size:2.5rem;font-weight:800;color:var(--color-primary);visibility:hidden}.auth-controls{display:flex;align-items:center;gap:1rem}.input-group{display:flex;flex-direction:column;margin-bottom:1rem;flex-grow:1}.input-grid{display:flex;gap:1rem;flex-wrap:wrap}label{margin-bottom:.25rem;font-size:.875rem;color:var(--color-text)}input[type="text"],input[type="number"],input[type="date"],select{padding:.5rem;border-radius:.375rem;border:1px solid var(--color-bg-light);background-color:var(--color-bg-mid);color:var(--color-text);transition:border-color .2s;min-width:150px}input[type="text"]:focus,input[type="number"]:focus,input[type="date"]:focus,select:focus{border-color:var(--color-primary);outline:none}.checkbox-group{display:flex;align-items:center;margin-top:1.5rem;gap:.5rem}button{padding:.75rem 1.5rem;border-radius:.5rem;font-weight:600;cursor:pointer;transition:background-color .2s,transform .1s;border:none}.btn-primary{background-color:#2d3748;color:#9ca3af;font-size:.75rem;padding:.5rem 1rem;border:1px solid #1f2937}.btn-primary:hover{background-color:#374151}.btn-secondary{background-color:var(--color-bg-light);color:var(--color-text)}.btn-secondary:hover{background-color:#4b5563}.section-box{background-color:var(--color-bg-mid);border-radius:.75rem;padding:2rem;margin-bottom:2rem;border:1px solid var(--color-bg-light)}.section-box h3{font-size:1.5rem;font-weight:700;margin-top:0;margin-bottom:1.5rem;color:var(--color-primary)}.grid-section{width:100%;padding:2.5rem 0;background-color:var(--color-bg-mid);display:flex;justify-content:center;border-bottom:1px solid var(--color-bg-light);margin-top:1rem}.grid-content-box{box-shadow:0 5px 10px rgba(0,0,0,.5);border-radius:.5rem;padding:1rem;background-color:var(--color-bg-dark);border:1px solid var(--color-bg-light);width:fit-content;display:flex;flex-direction:column;align-items:center}.grid-title{font-size:1.5rem;font-weight:700;margin-bottom:1rem;text-align:center}.grid-container{display:grid;grid-template-columns:repeat(53,12px);grid-template-rows:repeat(7,12px);gap:2px;width:fit-content;max-width:none;grid-auto-flow:column}.grid-cell{border-radius:2px;transition:background-color .15s ease-in-out;cursor:pointer}.grid-cell:hover{opacity:.8}.grid-cell.cell-0{background-color:var(--color-cell-0)}.grid-cell.cell-1{background-color:var(--color-cell-1)}.grid-cell.cell-2{background-color:var(--color-cell-2)}.grid-cell.cell-3{background-color:var(--color-cell-3)}.grid-cell.cell-4{background-color:var(--color-cell-4)}.hue-shift-plus{filter:hue-rotate(120deg)}.hue-shift-minus{filter:hue-rotate(-120deg)}.toast{visibility:hidden;min-width:250px;margin-left:-125px;background-color:#333;color:#fff;text-align:center;border-radius:2px;padding:16px;position:fixed;z-index:100;left:50%;bottom:30px;font-size:17px;transition:opacity .3s,background-color .3s;opacity:0}.toast.show{visibility:visible;animation:fadein .5s,fadeout .5s 2.5s;opacity:1}.toast.error{background-color:var(--color-error)}.toast.success{background-color:var(--color-success)}@keyframes fadein{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}@keyframes fadeout{from{opacity:1}to{opacity:0}}#details-modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.8);align-items:center;justify-content:center}#modal-content{background-color:var(--color-bg-mid);border-radius:0.75rem;max-width:90%;max-height:80%;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,0.5);border:1px solid var(--color-bg-light);position:relative}#modal-content h3{font-size:1.25rem;margin-bottom:1rem}#modal-content ul{list-style:none;padding:0;margin:0}#modal-content li{padding:0.75rem;margin:0.5rem 0;background-color:var(--color-bg-dark);border-radius:0.375rem;font-size:0.875rem;border-left:3px solid var(--color-primary);line-height:1.6}.close-modal{position:absolute;top:1rem;right:1rem;font-size:1.5rem;color:var(--color-text);cursor:pointer;background:none;border:none;padding:0.5rem}.close-modal:hover{color:var(--color-primary)}@media (max-width:768px){.header h1{font-size:1.8rem}.header{flex-direction:column;gap:1rem}.auth-controls{width:100%}.input-grid{flex-direction:column}.section-box{padding:1rem}.grid-content-box{width:95%;padding:0.5rem}.grid-title{font-size:1rem}.grid-container{grid-template-columns:repeat(53,6px);grid-template-rows:repeat(7,6px);gap:1px}#modal-content{max-width:95%;padding:1rem}}
</style>
</head>
<body>
<div id="details-modal" onclick="if(event.target===this)closeModal()">
<div id="modal-content">
<button class="close-modal" onclick="closeModal()">√ó</button>
</div>
</div>
<div id="toast-message" class="toast"></div>
<div class="main-container">
<header class="header">
<h1>Val-Stats</h1>
<div class="auth-controls">
<div id="data-entry-section" style="display:none;" class="auth-controls">
<span id="user-email"></span>
<button onclick="handleSignOut()" class="btn-secondary">Sign Out</button>
</div>
<div id="login-section">
<button onclick="handleSignIn()" class="btn-primary">Sign In (Owner)</button>
</div>
</div>
</header>
<div id="import-container" class="section-box" style="display:none;">
<h3>Import Letterboxd Data (One-Time)</h3>
<div style="margin-bottom:1rem;">
<input type="file" id="letterboxd-file" accept=".json" style="margin-bottom:0.5rem;">
<button onclick="handleLetterboxdImport()" class="btn-primary">Import JSON</button>
<p style="font-size:0.875rem;color:#9ca3af;margin-top:0.5rem;">This will import all movies from your letterboxd.json file.</p>
</div>
</div>
<div id="entry-container" class="section-box" style="display:none;">
<h3>Log New Daily Entry (Owner Only)</h3>
<form id="entry-form" onsubmit="event.preventDefault();handleEntrySubmission();">
<div class="input-grid">
<div class="input-group">
<label for="entry-type">Type</label>
<select id="entry-type" required>
<option value="movie">Movie</option>
<option value="book">Book</option>
</select>
</div>
<div class="input-group">
<label for="entry-title">Title</label>
<input type="text" id="entry-title" required>
</div>
<div class="input-group">
<label for="entry-duration">Duration (Minutes)</label>
<input type="number" id="entry-duration" required min="1">
</div>
<div class="input-group">
<label for="entry-date">Date</label>
<input type="date" id="entry-date" required>
</div>
</div>
<hr style="margin:1.5rem 0;border-color:var(--color-bg-light);">
<div class="input-grid">
<div class="input-group">
<label for="entry-director">Director</label>
<input type="text" id="entry-director">
</div>
<div class="input-group">
<label for="entry-rating">Rating (0-5)</label>
<input type="number" id="entry-rating" step="0.5" min="0" max="5">
</div>
<div class="input-group">
<label for="entry-letterboxd">Letterboxd ID (Optional)</label>
<input type="text" id="entry-letterboxd" placeholder="e.g. 191832">
</div>
<div class="checkbox-group">
<input type="checkbox" id="entry-theater">
<label for="entry-theater" style="margin-bottom:0;">Watched In Theater?</label>
</div>
</div>
<button type="submit" class="btn-primary" style="margin-top:1.5rem;">Submit Entry</button>
</form>
</div>
<div id="director-filter-container" class="section-box" style="padding:1rem 2rem;display:none;">
</div>
<div class="grid-section-wrapper">
<section class="grid-section">
<div class="grid-content-box">
<h2 class="grid-title">GitHub Contributions</h2>
<div id="grid-container-1" class="grid-container">
<div style="padding:2rem;color:#555;">Loading data...</div>
</div>
</div>
</section>
<section class="grid-section hue-shift-minus">
<div class="grid-content-box">
<h2 class="grid-title">Movies Watched in Minutes</h2>
<div id="grid-container-3" class="grid-container">
<div style="padding:2rem;color:#555;">Loading data...</div>
</div>
</div>
</section>
<section class="grid-section hue-shift-plus" style="border-bottom:none;">
<div class="grid-content-box">
<h2 class="grid-title">Books Read in Minutes</h2>
<div id="grid-container-2" class="grid-container">
<div style="padding:2rem;color:#555;">Loading data...</div>
</div>
</div>
</section>
</div>
</div>
</body>
</html>