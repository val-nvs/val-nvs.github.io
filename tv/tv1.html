<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Broadcast Table</title>
<style>
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

body {
	background: #0a0a0a;
	font-family: 'Arial', sans-serif;
	overflow: hidden;
	position: relative;
	height: 100vh;
	display: flex;
	align-items: center;
	justify-content: center;
}

/* Unified Broadcast Unit */
.broadcast-unit {
	background: #1a1a1a;
	border-radius: 15px;
	padding: 30px;
	box-shadow: 0 10px 40px rgba(0,0,0,0.5);
	position: relative;
	max-width: 95vw;
	margin: 0 auto;
}

/* Top Section with Monitor and SDI Ports */
.top-section {
	margin-bottom: 20px;
}

/* SDI Ports Section */
.sdi-section {
	display: flex;
	gap: 15px;
	justify-content: center;
	margin-bottom: 15px;
}

.sdi-port {
	width: 40px;
	height: 40px;
	background: radial-gradient(circle, #2a2a2a 40%, #1a1a1a 100%);
	border: 3px solid #444;
	border-radius: 50%;
	position: relative;
	cursor: pointer;
	transition: all 0.2s;
}

.sdi-port::before {
	content: '';
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	width: 15px;
	height: 15px;
	background: #000;
	border-radius: 50%;
}

.sdi-port::after {
	content: attr(data-label);
	position: absolute;
	bottom: -18px;
	left: 50%;
	transform: translateX(-50%);
	color: #666;
	font-size: 8px;
	white-space: nowrap;
}

.sdi-port.connected {
	border-color: #0f0;
	background: radial-gradient(circle, #1a3a1a 40%, #0a2a0a 100%);
	box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
}

/* Monitor Section - TV Switcher Layout with proper 16:9 */
.monitor-section {
	width: 100%;
	margin-bottom: 20px;
	padding-bottom: 20px;
	border-bottom: 2px solid #333;
}

.monitor {
	background: #111;
	border: 2px solid #333;
	border-radius: 5px;
	padding: 8px;
	width: 100%;
}

.monitor-screen {
	width: 100%;
	background: #000;
	border-radius: 3px;
	position: relative;
	display: flex;
	flex-direction: column;
	gap: 3px;
}

/* Output Row - Preview and Program with 16:9 */
.output-row {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 3px;
}

.output-feed {
	position: relative;
	width: 100%;
	padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
	background: #000;
	border: 1px solid #222;
}

.output-feed .video-container {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	overflow: hidden;
}

/* Source Rows - 8 inputs with 16:9 */
.source-row {
	display: grid;
	grid-template-columns: repeat(4, 1fr);
	gap: 3px;
}

.source-feed {
	position: relative;
	width: 100%;
	padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
	background: #000;
	border: 1px solid #222;
}

.source-feed .video-container {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	overflow: hidden;
}

.video-container video {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.video-container::before {
	content: attr(data-channel);
	position: absolute;
	top: 2px;
	left: 2px;
	background: rgba(0, 0, 0, 0.8);
	color: #0f0;
	padding: 2px 5px;
	font-size: 8px;
	font-family: monospace;
	z-index: 10;
	border-radius: 2px;
}

.output-feed.preview {
	border: 2px solid #ff0;
}

.output-feed.preview .video-container::before {
	color: #ff0;
	background: rgba(0, 0, 0, 0.9);
}

.output-feed.program {
	border: 2px solid #f00;
}

.output-feed.program .video-container::before {
	color: #f00;
	background: rgba(0, 0, 0, 0.9);
}

.source-feed.selected-preview {
	border: 2px solid #ff0;
}

.source-feed.selected-program {
	border: 2px solid #f00;
}

.source-feed.disconnected {
	opacity: 0.3;
}

.source-feed.disconnected video {
	display: none;
}

.monitor-screen:not(.active)::after {
	content: 'NO SIGNAL';
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	color: #0f0;
	opacity: 0.5;
	font-family: monospace;
	font-size: 14px;
	z-index: 20;
}

.monitor-label {
	text-align: center;
	color: #666;
	font-size: 10px;
	margin-top: 5px;
}

/* Main Grid */
.grid-section {
	background: #222;
	padding: 15px;
	border-radius: 8px;
}

.grid {
	display: grid;
	grid-template-columns: repeat(22, minmax(60px, 1fr));
	grid-template-rows: repeat(4, minmax(60px, 1fr));
	gap: 0.1rem;
	width: 100%;
}

.grid > div {
	aspect-ratio: 1/1;
}

.grid > div > button {
	width: 100%;
	height: 100%;
	border: none;
	border-radius: 3px;
	font-size: 9px;
	font-weight: bold;
	transition: all 0.1s;
	position: relative;
	overflow: hidden;
}

/* Screen buttons (no class) */
.grid > div > button:not(.off) {
	background: #113;
	cursor: default;
	border: 1px solid #003;
}

/* Off buttons (clickable) */
.grid > div > button.off {
	background: #aaa;
	cursor: pointer;
	border: 1px solid #888;
	color: #333;
}

.grid > div > button.off:hover {
	background: #bbb;
}

/* Active state - only red now */
.grid > div > button.off.red {
	background: #f00;
	color: #fff;
	box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
}

/* LED indicator on buttons */
.grid > div > button.off::after {
	content: '';
	position: absolute;
	top: 2px;
	right: 2px;
	width: 3px;
	height: 3px;
	background: #666;
	border-radius: 50%;
}

.grid > div > button.off.red::after {
	background: #fff;
	box-shadow: 0 0 3px currentColor;
}

/* SDI Cables with Bezier curves */
.cable-svg {
	width: 100vw;
	height: 100vh;
	position: fixed;
	top: 0;
	left: 0;
	pointer-events: none;
	z-index: 5;
}

.cable-path {
	fill: none;
	stroke-width: 5;
	stroke-linecap: round;
	filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
	pointer-events: none;
}

/* Cable Connector with realistic plug */
.cable-connector {
	position: absolute;
	width: 40px;
	height: 24px;
	cursor: grab;
	pointer-events: all;
	z-index: 100;
	display: flex;
	align-items: center;
}

.cable-plug {
	width: 100%;
	height: 100%;
	position: relative;
	display: flex;
	align-items: center;
}

.cable-plug-body {
	width: 32px;
	height: 18px;
	background: linear-gradient(90deg, #444 0%, #666 50%, #444 100%);
	border: 1px solid #222;
	border-radius: 3px;
	position: relative;
}

.cable-plug-tip {
	width: 8px;
	height: 12px;
	background: linear-gradient(90deg, #222, #333);
	border: 1px solid #111;
	border-radius: 0 2px 2px 0;
	position: absolute;
	right: -8px;
	top: 50%;
	transform: translateY(-50%);
}

.cable-plug-ring {
	width: 20px;
	height: 20px;
	background: radial-gradient(circle, #555 30%, #333 100%);
	border: 1px solid #222;
	border-radius: 50%;
	position: absolute;
	left: -10px;
	top: 50%;
	transform: translateY(-50%);
}

.cable-connector:active {
	cursor: grabbing;
}

.cable-connector:active .cable-plug-body {
	transform: scale(1.05);
}

.cable-connector.dragging {
	z-index: 1000;
}

/* Cable colors - 8 cables now */
.cable-1 .cable-path { stroke: #ff006e; }
.cable-2 .cable-path { stroke: #00ff88; }
.cable-3 .cable-path { stroke: #00b4ff; }
.cable-4 .cable-path { stroke: #ffaa00; }
.cable-5 .cable-path { stroke: #ff00ff; }
.cable-6 .cable-path { stroke: #88ff00; }
.cable-7 .cable-path { stroke: #ff6600; }
.cable-8 .cable-path { stroke: #00ffff; }

.cable-1 .cable-plug-body { box-shadow: 0 0 8px #ff006e; }
.cable-2 .cable-plug-body { box-shadow: 0 0 8px #00ff88; }
.cable-3 .cable-plug-body { box-shadow: 0 0 8px #00b4ff; }
.cable-4 .cable-plug-body { box-shadow: 0 0 8px #ffaa00; }
.cable-5 .cable-plug-body { box-shadow: 0 0 8px #ff00ff; }
.cable-6 .cable-plug-body { box-shadow: 0 0 8px #88ff00; }
.cable-7 .cable-plug-body { box-shadow: 0 0 8px #ff6600; }
.cable-8 .cable-plug-body { box-shadow: 0 0 8px #00ffff; }

</style>
</head>
<body>

<!-- SDI Cables with Bezier Curves -->
<svg class="cable-svg">
	<g class="sdi-cable cable-1" data-cable="1">
		<path class="cable-path" d=""></path>
	</g>
	<g class="sdi-cable cable-2" data-cable="2">
		<path class="cable-path" d=""></path>
	</g>
	<g class="sdi-cable cable-3" data-cable="3">
		<path class="cable-path" d=""></path>
	</g>
	<g class="sdi-cable cable-4" data-cable="4">
		<path class="cable-path" d=""></path>
	</g>
	<g class="sdi-cable cable-5" data-cable="5">
		<path class="cable-path" d=""></path>
	</g>
	<g class="sdi-cable cable-6" data-cable="6">
		<path class="cable-path" d=""></path>
	</g>
	<g class="sdi-cable cable-7" data-cable="7">
		<path class="cable-path" d=""></path>
	</g>
	<g class="sdi-cable cable-8" data-cable="8">
		<path class="cable-path" d=""></path>
	</g>
</svg>

<!-- Cable Connectors with Plug Design -->
<div class="cable-connector cable-1" data-cable="1" style="left: 50px; top: 0px;">
	<div class="cable-plug">
		<div class="cable-plug-ring"></div>
		<div class="cable-plug-body"></div>
		<div class="cable-plug-tip"></div>
	</div>
</div>
<div class="cable-connector cable-2" data-cable="2" style="left: 150px; top: 0px;">
	<div class="cable-plug">
		<div class="cable-plug-ring"></div>
		<div class="cable-plug-body"></div>
		<div class="cable-plug-tip"></div>
	</div>
</div>
<div class="cable-connector cable-3" data-cable="3" style="left: 250px; top: 0px;">
	<div class="cable-plug">
		<div class="cable-plug-ring"></div>
		<div class="cable-plug-body"></div>
		<div class="cable-plug-tip"></div>
	</div>
</div>
<div class="cable-connector cable-4" data-cable="4" style="left: 350px; top: 0px;">
	<div class="cable-plug">
		<div class="cable-plug-ring"></div>
		<div class="cable-plug-body"></div>
		<div class="cable-plug-tip"></div>
	</div>
</div>
<div class="cable-connector cable-5" data-cable="5" style="left: 450px; top: 0px;">
	<div class="cable-plug">
		<div class="cable-plug-ring"></div>
		<div class="cable-plug-body"></div>
		<div class="cable-plug-tip"></div>
	</div>
</div>
<div class="cable-connector cable-6" data-cable="6" style="left: 550px; top: 0px;">
	<div class="cable-plug">
		<div class="cable-plug-ring"></div>
		<div class="cable-plug-body"></div>
		<div class="cable-plug-tip"></div>
	</div>
</div>
<div class="cable-connector cable-7" data-cable="7" style="left: 650px; top: 0px;">
	<div class="cable-plug">
		<div class="cable-plug-ring"></div>
		<div class="cable-plug-body"></div>
		<div class="cable-plug-tip"></div>
	</div>
</div>
<div class="cable-connector cable-8" data-cable="8" style="left: 750px; top: 0px;">
	<div class="cable-plug">
		<div class="cable-plug-ring"></div>
		<div class="cable-plug-body"></div>
		<div class="cable-plug-tip"></div>
	</div>
</div>

<!-- Unified Broadcast Unit -->
<div class="broadcast-unit">
	<!-- Top Section -->
	<div class="top-section">
		<!-- SDI Ports -->
		<div class="sdi-section">
			<div class="sdi-port" data-label="SDI 1" data-input="1"></div>
			<div class="sdi-port" data-label="SDI 2" data-input="2"></div>
			<div class="sdi-port" data-label="SDI 3" data-input="3"></div>
			<div class="sdi-port" data-label="SDI 4" data-input="4"></div>
			<div class="sdi-port" data-label="SDI 5" data-input="5"></div>
			<div class="sdi-port" data-label="SDI 6" data-input="6"></div>
			<div class="sdi-port" data-label="SDI 7" data-input="7"></div>
			<div class="sdi-port" data-label="SDI 8" data-input="8"></div>
		</div>
		
		<!-- Full Width Monitor with TV Switcher Layout -->
		<div class="monitor-section">
			<div class="monitor">
				<div class="monitor-screen" id="monitor-screen">
					<!-- Output Row - Preview and Program -->
					<div class="output-row">
						<div class="output-feed preview">
							<div class="video-container" data-channel="PREVIEW">
								<video id="preview-video" loop muted preload="auto">
									<source src="video1.mp4" type="video/mp4">
								</video>
							</div>
						</div>
						<div class="output-feed program">
							<div class="video-container" data-channel="PROGRAM">
								<video id="program-video" loop muted preload="auto">
									<source src="video1.mp4" type="video/mp4">
								</video>
							</div>
						</div>
					</div>
					<!-- Source Row 1 -->
					<div class="source-row">
						<div class="source-feed disconnected" data-source="1">
							<div class="video-container" data-channel="IN 1">
								<video loop muted preload="auto">
									<source src="video1.mp4" type="video/mp4">
								</video>
							</div>
						</div>
						<div class="source-feed disconnected" data-source="2">
							<div class="video-container" data-channel="IN 2">
								<video loop muted preload="auto">
									<source src="video2.mp4" type="video/mp4">
								</video>
							</div>
						</div>
						<div class="source-feed disconnected" data-source="3">
							<div class="video-container" data-channel="IN 3">
								<video loop muted preload="auto">
									<source src="video3.mp4" type="video/mp4">
								</video>
							</div>
						</div>
						<div class="source-feed disconnected" data-source="4">
							<div class="video-container" data-channel="IN 4">
								<video loop muted preload="auto">
									<source src="video4.mp4" type="video/mp4">
								</video>
							</div>
						</div>
					</div>
					<!-- Source Row 2 -->
					<div class="source-row">
						<div class="source-feed disconnected" data-source="5">
							<div class="video-container" data-channel="IN 5">
								<video loop muted preload="auto">
									<source src="video5.mp4" type="video/mp4">
								</video>
							</div>
						</div>
						<div class="source-feed disconnected" data-source="6">
							<div class="video-container" data-channel="IN 6">
								<video loop muted preload="auto">
									<source src="video6.mp4" type="video/mp4">
								</video>
							</div>
						</div>
						<div class="source-feed disconnected" data-source="7">
							<div class="video-container" data-channel="IN 7">
								<video loop muted preload="auto">
									<source src="video7.mp4" type="video/mp4">
								</video>
							</div>
						</div>
						<div class="source-feed disconnected" data-source="8">
							<div class="video-container" data-channel="IN 8">
								<video loop muted preload="auto">
									<source src="video8.mp4" type="video/mp4">
								</video>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="monitor-label">MULTIVIEW - BROADCAST SWITCHER</div>
		</div>
	</div>
	
	<!-- Grid Section -->
	<div class="grid-section">
		<div class="grid">
			<!-- Row 1 - Program Control -->
			<div><button class="off program-btn" data-source="1">1</button></div>
			<div><button class="off program-btn" data-source="2">2</button></div>
			<div><button class="off program-btn" data-source="3">3</button></div>
			<div><button class="off program-btn" data-source="4">4</button></div>
			<div><button class="off program-btn" data-source="5">5</button></div>
			<div><button class="off program-btn" data-source="6">6</button></div>
			<div><button class="off program-btn" data-source="7">7</button></div>
			<div><button class="off program-btn" data-source="8">8</button></div>
			<div><button class="off">9</button></div>
			<div><button class="off">10</button></div>
			<div></div>
			<div><button class="off">A</button></div>
			<div></div>
			<div><button class="off">DIP</button></div>
			<div><button class="off">DVE</button></div>
			<div><button class="off">STING</button></div>
			<div></div>
			<div></div>
			<div><button class="off">A</button></div>
			<div><button class="off">A</button></div>
			<div></div>
			<div></div>

			<!-- Row 2 - Screens -->
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div></div>
			<div></div>
			<div></div>
			<div><button class="off">MIX</button></div>
			<div><button class="off">WIPE</button></div>
			<div><button class="off">ARM</button></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>

			<!-- Row 3 - Preview Control -->
			<div><button class="off preview-btn" data-source="1">1</button></div>
			<div><button class="off preview-btn" data-source="2">2</button></div>
			<div><button class="off preview-btn" data-source="3">3</button></div>
			<div><button class="off preview-btn" data-source="4">4</button></div>
			<div><button class="off preview-btn" data-source="5">5</button></div>
			<div><button class="off preview-btn" data-source="6">6</button></div>
			<div><button class="off preview-btn" data-source="7">7</button></div>
			<div><button class="off preview-btn" data-source="8">8</button></div>
			<div><button class="off">9</button></div>
			<div><button class="off">10</button></div>
			<div></div>
			<div><button class="off">A</button></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div><button class="off">A</button></div>
			<div><button class="off">A</button></div>
			<div></div>
			<div></div>

			<!-- Row 4 - Screens -->
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div><button class=""></button></div>
			<div></div>
			<div></div>
			<div></div>
			<div><button class="off">CUT</button></div>
			<div></div>
			<div><button class="off">AUTO</button></div>
			<div></div>
			<div></div>
			<div><button class="off">A</button></div>
			<div><button class="off">A</button></div>
			<div></div>
			<div><button class="off">FTB</button></div>
		</div>
	</div>
</div>

<audio id="keySound" preload="auto">
	<source src="key.wav" type="audio/wav">
</audio>

<script>
// Get elements
const buttons = document.querySelectorAll('.grid button.off');
const programButtons = document.querySelectorAll('.program-btn');
const previewButtons = document.querySelectorAll('.preview-btn');
const keySound = document.getElementById('keySound');
const monitorScreen = document.getElementById('monitor-screen');
const connectors = document.querySelectorAll('.cable-connector');
const ports = document.querySelectorAll('.sdi-port');
const previewVideo = document.getElementById('preview-video');
const programVideo = document.getElementById('program-video');
const sourceFeedsElements = document.querySelectorAll('.source-feed');

// Current preview and program sources
let previewSource = 1;
let programSource = 1;

// Connected sources
const connectedSources = new Set();

// Program buttons (first row)
programButtons.forEach(button => {
	button.addEventListener('click', function() {
		// Play sound
		try {
			keySound.currentTime = 0;
			keySound.play().catch(e => console.log('Audio play failed:', e));
		} catch(e) {
			console.log('Audio not available');
		}

		// Clear all program buttons
		programButtons.forEach(btn => btn.classList.remove('red'));
		
		// Set this button to red
		this.classList.add('red');
		
		// Update program source
		const sourceNum = parseInt(this.dataset.source);
		programSource = sourceNum;
		programVideo.src = `video${sourceNum}.mp4`;
		programVideo.load();
		programVideo.play().catch(e => console.log('Program play failed:', e));
		
		// Update source highlights
		sourceFeedsElements.forEach(feed => {
			feed.classList.remove('selected-program');
		});
		document.querySelector(`.source-feed[data-source="${sourceNum}"]`).classList.add('selected-program');
	});
});

// Preview buttons (third row)
previewButtons.forEach(button => {
	button.addEventListener('click', function() {
		// Play sound
		try {
			keySound.currentTime = 0;
			keySound.play().catch(e => console.log('Audio play failed:', e));
		} catch(e) {
			console.log('Audio not available');
		}

		// Clear all preview buttons
		previewButtons.forEach(btn => btn.classList.remove('red'));
		
		// Set this button to red
		this.classList.add('red');
		
		// Update preview source
		const sourceNum = parseInt(this.dataset.source);
		previewSource = sourceNum;
		previewVideo.src = `video${sourceNum}.mp4`;
		previewVideo.load();
		previewVideo.play().catch(e => console.log('Preview play failed:', e));
		
		// Update source highlights
		sourceFeedsElements.forEach(feed => {
			feed.classList.remove('selected-preview');
		});
		document.querySelector(`.source-feed[data-source="${sourceNum}"]`).classList.add('selected-preview');
	});
});

// Other buttons (just toggle red)
buttons.forEach(button => {
	if (!button.classList.contains('program-btn') && !button.classList.contains('preview-btn')) {
		button.addEventListener('click', function() {
			// Play sound
			try {
				keySound.currentTime = 0;
				keySound.play().catch(e => console.log('Audio play failed:', e));
			} catch(e) {
				console.log('Audio not available');
			}
			
			// Toggle red state
			this.classList.toggle('red');
		});
	}
});

// Cable data - all from top
const cableData = {};
for (let i = 1; i <= 8; i++) {
	cableData[i] = { 
		start: { x: 50 + (i - 1) * 100 + 20, y: 12 }, 
		end: null, 
		connected: false,
		port: null
	};
}

// Update bezier curves
function updateCablePath(cableNum) {
	const cable = cableData[cableNum];
	const path = document.querySelector(`.cable-${cableNum} .cable-path`);
	
	if (!cable.end) {
		cable.end = { ...cable.start };
	}
	
	// Calculate bezier curve
	const dx = cable.end.x - cable.start.x;
	const dy = cable.end.y - cable.start.y;
	const distance = Math.sqrt(dx * dx + dy * dy);
	
	// Create natural hanging curve
	const sag = Math.min(distance * 0.4, 200);
	
	// Control points for hanging cable effect
	const cp1x = cable.start.x + dx * 0.3;
	const cp1y = cable.start.y + Math.abs(dy * 0.3) + sag * 0.5;
	const cp2x = cable.end.x - dx * 0.3;
	const cp2y = cable.end.y - Math.abs(dy * 0.3) + sag * 0.5;
	
	const d = `M ${cable.start.x} ${cable.start.y} C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${cable.end.x} ${cable.end.y}`;
	path.setAttribute('d', d);
}

// Initialize cables
Object.keys(cableData).forEach(num => updateCablePath(num));

// Draggable connectors
connectors.forEach(connector => {
	let isDragging = false;
	let offset = { x: 0, y: 0 };
	const cableNum = connector.dataset.cable;
	
	connector.addEventListener('mousedown', function(e) {
		isDragging = true;
		this.classList.add('dragging');
		const rect = this.getBoundingClientRect();
		offset.x = e.clientX - rect.left - 20;
		offset.y = e.clientY - rect.top - 12;
		e.preventDefault();
	});
	
	document.addEventListener('mousemove', function(e) {
		if (isDragging) {
			const x = e.clientX - offset.x;
			const y = e.clientY - offset.y;
			
			connector.style.left = (x - 20) + 'px';
			connector.style.top = (y - 12) + 'px';
			
			cableData[cableNum].end = { x: x, y: y };
			updateCablePath(cableNum);
			
			// Check proximity to ports
			ports.forEach(port => {
				const rect = port.getBoundingClientRect();
				const portX = rect.left + rect.width / 2;
				const portY = rect.top + rect.height / 2;
				const dist = Math.sqrt((x - portX) ** 2 + (y - portY) ** 2);
				
				if (dist < 25) {
					port.style.transform = 'scale(1.15)';
					port.style.borderColor = '#0f0';
				} else if (!port.classList.contains('connected')) {
					port.style.transform = '';
					port.style.borderColor = '#444';
				}
			});
		}
	});
	
	document.addEventListener('mouseup', function(e) {
		if (isDragging) {
			isDragging = false;
			connector.classList.remove('dragging');
			
			// Check for port connection
			let connected = false;
			ports.forEach(port => {
				const rect = port.getBoundingClientRect();
				const portX = rect.left + rect.width / 2;
				const portY = rect.top + rect.height / 2;
				const x = e.clientX - offset.x;
				const y = e.clientY - offset.y;
				const dist = Math.sqrt((x - portX) ** 2 + (y - portY) ** 2);
				
				if (dist < 25) {
					// Snap to port
					connector.style.left = (portX - 20) + 'px';
					connector.style.top = (portY - 12) + 'px';
					cableData[cableNum].end = { x: portX, y: portY };
					cableData[cableNum].connected = true;
					cableData[cableNum].port = port.dataset.input;
					updateCablePath(cableNum);
					
					port.classList.add('connected');
					port.style.transform = '';
					
					// Enable the corresponding source feed
					const sourceNum = port.dataset.input;
					const sourceFeed = document.querySelector(`.source-feed[data-source="${sourceNum}"]`);
					sourceFeed.classList.remove('disconnected');
					const sourceVideo = sourceFeed.querySelector('video');
					sourceVideo.play().catch(e => console.log('Source video play failed:', e));
					
					connectedSources.add(sourceNum);
					
					if (connectedSources.size > 0) {
						monitorScreen.classList.add('active');
						// Play preview and program videos
						previewVideo.play().catch(e => console.log('Preview play failed:', e));
						programVideo.play().catch(e => console.log('Program play failed:', e));
					}
					
					connected = true;
					
					// Play sound
					try {
						keySound.currentTime = 0;
						keySound.play().catch(e => console.log('Audio play failed:', e));
					} catch(e) {
						console.log('Audio not available');
					}
				}
			});
			
			// Spring back if not connected
			if (!connected && !cableData[cableNum].connected) {
				connector.style.transition = 'all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
				connector.style.left = cableData[cableNum].start.x - 20 + 'px';
				connector.style.top = '0px';
				
				setTimeout(() => {
					cableData[cableNum].end = null;
					updateCablePath(cableNum);
					connector.style.transition = '';
				}, 500);
			}
		}
	});
});

// Port click to disconnect
ports.forEach(port => {
	port.addEventListener('click', function() {
		if (this.classList.contains('connected')) {
			this.classList.remove('connected');
			this.style.borderColor = '#444';
			
			const sourceNum = this.dataset.input;
			const rect = this.getBoundingClientRect();
			const portX = rect.left + rect.width / 2;
			const portY = rect.top + rect.height / 2;
			
			// Disable the corresponding source feed
			const sourceFeed = document.querySelector(`.source-feed[data-source="${sourceNum}"]`);
			sourceFeed.classList.add('disconnected');
			const sourceVideo = sourceFeed.querySelector('video');
			sourceVideo.pause();
			
			connectedSources.delete(sourceNum);
			
			Object.keys(cableData).forEach(num => {
				if (cableData[num].connected && cableData[num].port === sourceNum) {
					cableData[num].connected = false;
					cableData[num].end = null;
					cableData[num].port = null;
					
					const connector = document.querySelector(`.cable-connector[data-cable="${num}"]`);
					connector.style.transition = 'all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
					connector.style.left = cableData[num].start.x - 20 + 'px';
					connector.style.top = '0px';
					
					setTimeout(() => {
						updateCablePath(num);
						connector.style.transition = '';
					}, 500);
				}
			});
			
			if (connectedSources.size === 0) {
				monitorScreen.classList.remove('active');
				previewVideo.pause();
				programVideo.pause();
			}
		}
	});
});

// Update on resize
window.addEventListener('resize', () => {
	Object.keys(cableData).forEach(num => {
		if (!cableData[num].connected) {
			updateCablePath(num);
		}
	});
});
</script>
</body>
</html>