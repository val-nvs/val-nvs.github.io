<!DOCTYPE html>
<html lang="en" data-font="default" data-fontsize="medium">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>portfolio</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300&family=Atkinson+Hyperlegible:wght@400;700&display=swap');

  @font-face {
    font-family: 'OpenDyslexic';
    src: url('fonts/OpenDyslexic-Regular.otf') format('opentype');
    font-weight: 400;
    font-style: normal;
  }

  :root {
    --font-default: 'Cormorant Garamond', serif;
    --font-atkinson: 'Atkinson Hyperlegible', sans-serif;
    --font-dyslexic: 'OpenDyslexic', sans-serif;
    --font-active: var(--font-default);
    --size-scale: 1;
  }
  [data-font="atkinson"] { --font-active: var(--font-atkinson); }
  [data-font="dyslexic"] { --font-active: var(--font-dyslexic); }
  [data-fontsize="small"] { --size-scale: 0.8; }
  [data-fontsize="large"] { --size-scale: 1.25; }
  [data-font="default"] { --size-scale: 1.1; }
  [data-font="default"][data-fontsize="small"] { --size-scale: 0.88; }
  [data-font="default"][data-fontsize="large"] { --size-scale: 1.375; }

  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  html {
    height: 100%;
    scroll-snap-type: y mandatory;
    overflow-y: scroll;
    scrollbar-width: none;
    background: #0a0a0a;
  }
  html::-webkit-scrollbar { display: none; }

  body {
    margin: 0;
    font-family: var(--font-active);
    background: #0a0a0a;
    color: #fff;
  }

  /* ══════ LOADER ══════ */
  #loader {
    position: fixed; inset: 0; z-index: 100;
    background: #0a0a0a;
    display: flex; align-items: center; justify-content: center;
    transition: opacity 0.8s ease, visibility 0.8s ease;
  }
  #loader.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
  #loader .pulse {
    width: 0.52rem; height: 0.52rem;
    background: #fff; border-radius: 50%;
    animation: pulse 1.4s ease-in-out infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 0.2; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.5); }
  }

  /* ══════ SLIDES ══════ */
  .slide {
    position: relative;
    width: 100%; height: 100dvh;
    scroll-snap-align: start;
    scroll-snap-stop: always;
    overflow: hidden;
    display: flex; align-items: center; justify-content: center;
    background: #0a0a0a;
  }
  .slide img.main-photo {
    position: absolute;
    object-fit: contain;
    opacity: 0;
    border-radius: 0.16rem;
    transition: opacity 0.6s ease;
  }
  .slide img.main-photo.loaded { opacity: 1; }
  .slide img.main-photo.expand {
    border-radius: 0;
    transition: width 5s cubic-bezier(0.22, 1, 0.36, 1),
                height 5s cubic-bezier(0.22, 1, 0.36, 1),
                border-radius 5s ease,
                opacity 0.6s ease;
  }
  .slide .vignette {
    position: absolute; inset: 0;
    pointer-events: none;
    background: radial-gradient(ellipse at center, transparent 55%, rgba(0,0,0,0.3) 100%);
    z-index: 2; opacity: 0;
    transition: opacity 0.5s ease 0.2s;
  }
  .slide.active .vignette { opacity: 1; }

  /* ══════ HERO SLIDE ══════ */
  .hero-grid {
    position: absolute; inset: 0;
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    grid-template-rows: repeat(5, 1fr);
    gap: 2px;
  }
  .hero-grid img {
    width: 100%; height: 100%;
    object-fit: cover;
    filter: grayscale(1);
    opacity: 0;
    animation: gridIn 0.15s ease forwards;
  }
  @keyframes gridIn {
    to { opacity: 1; }
  }
  .hero-overlay {
    position: absolute; inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 3;
  }
  .hero-text {
    position: absolute; z-index: 5;
    text-align: center;
    user-select: none;
  }
  .hero-text h1 {
    font-family: var(--font-active);
    font-size: calc(4rem * var(--size-scale));
    font-weight: 300;
    letter-spacing: 0.3em;
    text-transform: none;
    color: #fff;
    margin-bottom: 0.4rem;
  }
  .hero-text p {
    font-family: var(--font-active);
    font-size: calc(0.8rem * var(--size-scale));
    font-weight: 300;
    letter-spacing: 0.2em;
    text-transform: none;
    color: rgba(255,255,255,0.5);
  }

  /* ══════ PHOTO INFO (bottom left) ══════ */
  .photo-info {
    position: absolute;
    bottom: 1.5rem; left: 1.65rem;
    z-index: 10;
    font-size: calc(0.6rem * var(--size-scale));
    font-weight: 300;
    letter-spacing: 0.12em;
    line-height: 1.5;
    color: #fff;
    opacity: 0;
    transition: opacity 0.6s ease 0.4s;
    user-select: none;
    text-transform: none;
  }
  .slide.active .photo-info { opacity: 1; }
  .photo-info .info-line {
    display: flex; align-items: center; gap: 0.3rem;
    white-space: nowrap;
    cursor: default;
    position: relative;
  }
  .photo-info .info-line.hoverable { cursor: pointer; }
  .photo-info .info-line .extra-text { display: none; }
  .photo-info .info-line.hovered .extra-text { display: inline; }
  .photo-info .hover-photo {
    position: absolute;
    bottom: 100%;
    left: 0;
    margin-bottom: 0.4rem;
    width: 6rem;
    height: 6rem;
    border-radius: 0.4rem;
    object-fit: contain;
    background: rgba(15,15,15,0.6);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.3);
    padding: 0.4rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    display: none;
  }
  .photo-info .hover-photo.show { display: block; opacity: 1; }

  /* ══════ FROSTED GLASS (hero corners) ══════ */
  .frosted {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    background: rgba(0,0,0,0.3);
    border-radius: 0.3rem;
    padding: 0.25rem 0.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  }

  /* ══════ COUNTER (top left) ══════ */
  #counter {
    position: fixed; top: 1.45rem; left: 1.65rem; z-index: 50;
    font-size: calc(0.85rem * var(--size-scale)); font-weight: 300;
    letter-spacing: 0.15em;
    color: #fff; user-select: none;
    transition: opacity 0.4s ease;
  }

  /* ══════ LEATHER TAB (top center) ══════ */
  #leather-tab {
    position: fixed; top: 0; left: 50%; transform: translateX(-50%);
    z-index: 200;
    padding: 0.45rem 1.4rem 0.5rem;
    background:
      repeating-linear-gradient(45deg, transparent, transparent 1px, rgba(0,0,0,0.04) 1px, rgba(0,0,0,0.04) 2px),
      repeating-linear-gradient(-45deg, transparent, transparent 1px, rgba(0,0,0,0.04) 1px, rgba(0,0,0,0.04) 2px),
      linear-gradient(180deg, #8a6235, #6b4423, #5a3618);
    border-radius: 0 0 0.5rem 0.5rem;
    cursor: pointer;
    text-align: center;
    box-shadow: 0 3px 10px rgba(0,0,0,0.5);
    user-select: none;
    transition: box-shadow 0.3s ease;
  }
  #leather-tab:hover { box-shadow: 0 4px 14px rgba(0,0,0,0.7); }
  #leather-tab::after {
    content: '';
    position: absolute;
    left: 0.2rem; right: 0.2rem; bottom: 0.2rem; top: 0;
    border: 1.5px dashed rgba(255,255,255,0.18);
    border-top: none;
    border-radius: 0 0 0.4rem 0.4rem;
    pointer-events: none;
  }
  #leather-tab .tab-title {
    font-size: calc(0.7rem * var(--size-scale));
    font-weight: 300;
    letter-spacing: 0.25em;
    text-transform: none;
    color: rgba(255,255,255,0.85);
  }
  #leather-tab .tab-sub {
    font-size: calc(0.4rem * var(--size-scale));
    font-weight: 300;
    letter-spacing: 0.15em;
    text-transform: none;
    color: rgba(255,255,255,0.4);
    margin-top: 0.05rem;
  }

  /* ══════ SETTINGS BUTTON (top right) ══════ */
  #settings-btn {
    position: fixed; top: 1.25rem; right: 1.35rem; z-index: 200;
    width: 1.6rem; height: 1.6rem;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }
  #settings-btn svg {
    width: 1.1rem; height: 1.1rem;
    stroke: #fff; stroke-width: 1.5; fill: none;
    stroke-linecap: round; stroke-linejoin: round;
    transition: transform 0.4s ease;
  }
  #settings-btn:hover svg { transform: rotate(30deg); }

  /* ══════ SETTINGS POPUP ══════ */
  #settings-popup {
    position: fixed;
    top: 3.5rem; right: 1.35rem;
    z-index: 201;
    background: rgba(15,15,15,0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 0.4rem;
    padding: 0.8rem 1rem;
    opacity: 0; pointer-events: none;
    transform: translateY(-0.3rem);
    transition: opacity 0.3s ease, transform 0.3s ease;
    min-width: 14rem;
    border: 1px solid rgba(255,255,255,0.08);
  }
  #settings-popup.open {
    opacity: 1; pointer-events: auto; transform: translateY(0);
  }
  .setting-row {
    margin-bottom: 0.55rem;
  }
  .setting-row:last-child { margin-bottom: 0; }
  .setting-label {
    display: block;
    font-size: calc(0.45rem * var(--size-scale));
    font-weight: 300;
    letter-spacing: 0.2em;
    text-transform: none;
    color: rgba(255,255,255,0.4);
    margin-bottom: 0.25rem;
  }
  .setting-options {
    display: flex; gap: 0.25rem; flex-wrap: wrap;
  }
  .setting-btn {
    font-family: var(--font-active);
    font-size: calc(0.42rem * var(--size-scale));
    font-weight: 300;
    letter-spacing: 0.1em;
    text-transform: none;
    color: rgba(255,255,255,0.5);
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 0.2rem;
    padding: 0.2rem 0.45rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .setting-btn:hover { color: #fff; border-color: rgba(255,255,255,0.3); }
  .setting-btn.active {
    color: #fff;
    background: rgba(255,255,255,0.12);
    border-color: rgba(255,255,255,0.4);
  }

  /* ══════ FILM OVERLAY ══════ */
  #film-overlay {
    position: fixed; inset: 0; z-index: 150;
    pointer-events: none; opacity: 0;
    transition: opacity 0.4s ease;
  }
  #film-overlay.open { pointer-events: auto; opacity: 1; }
  #film-overlay .backdrop {
    position: absolute; inset: 0;
    background: rgba(0,0,0,0.6);
  }
  #film-panel {
    position: absolute;
    left: 50%; bottom: 0; top: 4rem;
    transform: translateX(-50%) translateY(calc(100% + 4rem));
    transition: transform 0.65s cubic-bezier(0.16, 1, 0.3, 1);
    z-index: 151;
    display: flex; flex-direction: column; align-items: center;
  }
  #film-overlay.open #film-panel.animate-in {
    transform: translateX(-50%) translateY(0);
  }
  #film-content {
    display: flex; flex-direction: row;
    align-items: flex-start; gap: 0.4rem;
    flex: 1; min-height: 0; overflow: hidden;
  }

  /* ── Film canister ── */
  #film-canister {
    width: 14rem; height: 10rem;
    position: relative;
    flex-shrink: 0;
    margin-top: 0;
    opacity: 0;
    transition: opacity 0.25s ease;
    margin-bottom: 1.5rem;
  }
  #film-canister.visible { opacity: 1; }
  .canister-body {
    position: absolute;
    top: 1.2rem; bottom: 1.2rem;
    left: 1rem; right: 1rem;
    background: linear-gradient(90deg, #333, #222, #2a2a2a, #222, #333);
    border-left: 1px solid #444;
    border-right: 1px solid #444;
  }
  .canister-cap {
    position: absolute;
    left: 0; right: 0; height: 2.4rem;
    background: linear-gradient(180deg, #444, #2a2a2a);
    border-radius: 50%;
    border: 1px solid #555;
  }
  .canister-cap.top { top: 0; }
  .canister-cap.bottom { bottom: 0; background: linear-gradient(180deg, #2a2a2a, #444); }
  .canister-label {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.45rem;
    letter-spacing: 0.2em;
    text-transform: none;
    color: #555;
    white-space: nowrap;
    user-select: none;
  }

  #film-strip, #categories-strip {
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  #film-strip .film-body, #categories-strip .film-body {
    flex: 1; min-height: 0;
  }
  .film-body {
    position: relative;
    background: #1a1a1a;
    display: flex; flex-direction: row;
    flex: 1; min-height: 0;
  }
  .sprockets {
    width: 0.9rem;
    display: flex; flex-direction: column;
    gap: 0.55rem; align-items: center;
    padding: 0.4rem 0; flex-shrink: 0;
  }
  .sprocket {
    width: 0.45rem; height: 0.3rem;
    border-radius: 0.06rem;
    background: #0a0a0a;
    border: 1px solid #333;
    flex-shrink: 0;
  }
  .film-frames {
    display: flex; flex-direction: column;
    gap: 0.35rem; padding: 0.5rem 0.15rem;
    overflow-y: auto; scrollbar-width: none;
  }
  .film-frames::-webkit-scrollbar { display: none; }
  .film-frame {
    position: relative;
    cursor: pointer;
    border-radius: 0.08rem;
    overflow: hidden;
    opacity: 0.6;
    transition: opacity 0.3s ease;
    border: 1px solid transparent;
    flex-shrink: 0;
  }
  .film-frame:hover { opacity: 1; }
  .film-frame.current { opacity: 1; border-color: #fff; }
  .film-frame img {
    display: block; width: 6rem; height: 4rem; object-fit: cover;
  }
  .film-frame .frame-num {
    position: absolute;
    bottom: 0.15rem; right: 0.25rem;
    font-size: 0.5rem; font-weight: 300;
    letter-spacing: 0.08em; color: #fff;
    text-shadow: 0 1px 3px rgba(0,0,0,0.8);
  }
  .film-edge-text {
    font-size: 0.35rem; font-weight: 300;
    letter-spacing: 0.15em; text-transform: none;
    color: #444;
    writing-mode: vertical-rl; text-orientation: mixed;
    padding: 0.4rem 0.1rem; user-select: none;
    white-space: nowrap; display: flex; align-items: center;
  }
  .cat-frames {
    display: flex; flex-direction: column;
    gap: 0.35rem; padding: 0.5rem 0.15rem;
  }
  .cat-frame {
    width: 6rem; height: 4rem;
    background: #1e1e1e;
    border: 1px solid #333;
    border-radius: 0.08rem;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; opacity: 0.5;
    transition: opacity 0.3s ease, border-color 0.3s ease;
    flex-shrink: 0;
  }
  .cat-frame:hover { opacity: 0.8; }
  .cat-frame.active { opacity: 1; border-color: #fff; }
  .cat-label {
    font-size: 0.6rem; font-weight: 300;
    letter-spacing: 0.2em; text-transform: none;
    color: #fff; user-select: none;
  }

  /* ══════ LOREM IPSUM WINDOW ══════ */
  #lorem-window {
    position: fixed;
    top: 5rem; left: 2rem;
    z-index: 152;
    width: 22rem;
    max-height: 60vh;
    background: rgba(15,15,15,0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 0.5rem;
    padding: 1.2rem 1.4rem;
    border: 1px solid rgba(255,255,255,0.08);
    opacity: 0; pointer-events: none;
    transform: translateY(0.5rem);
    transition: opacity 0.4s ease, transform 0.4s ease;
    overflow-y: auto;
  }
  #lorem-window.open { opacity: 1; pointer-events: auto; transform: translateY(0); }
  #lorem-window h2 {
    font-size: calc(1rem * var(--size-scale));
    font-weight: 300;
    letter-spacing: 0.15em;
    margin-bottom: 0.6rem;
    color: rgba(255,255,255,0.8);
  }
  #lorem-window p {
    font-size: calc(0.52rem * var(--size-scale));
    font-weight: 300;
    line-height: 1.7;
    color: rgba(255,255,255,0.5);
    margin-bottom: 0.5rem;
  }

  /* ══════ RESIZE HINT + PREVIEW ══════ */
  #resize-group {
    position: fixed;
    bottom: 1.35rem; right: 1.35rem;
    z-index: 50;
    display: flex; flex-direction: column;
    align-items: flex-end; gap: 0.4rem;
    opacity: 0;
    transition: opacity 0.5s ease, transform 0.5s ease;
    transform: translateY(0.3rem);
    pointer-events: none;
  }
  #resize-group.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
  #resize-group .label {
    font-size: calc(0.85rem * var(--size-scale)); font-weight: 300;
    letter-spacing: 0.18em; text-transform: none;
    color: #fff;
    white-space: nowrap; user-select: none; cursor: pointer;
    text-align: right; line-height: 1.3;
  }

  /* Crop preview */
  #crop-preview {
    position: relative;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  #resize-group.show-preview #crop-preview {
    opacity: 1;
  }
  #crop-preview .photo-full {
    position: absolute;
    border-radius: 0.15rem;
    border: 1px solid #fff;
    overflow: hidden;
    background: #3a0a0a;
  }
  #crop-preview .photo-full img {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover; opacity: 0.25;
  }
  #crop-preview .viewport-crop {
    position: absolute;
    border-radius: 0.1rem;
    border: 1px solid #fff;
    overflow: hidden;
  }
  #crop-preview .viewport-crop img {
    position: absolute; object-fit: cover; opacity: 0.9;
  }
  #crop-preview .ratio-label {
    position: absolute;
    font-size: calc(0.5rem * var(--size-scale));
    font-weight: 300;
    letter-spacing: 0.12em;
    color: #fff; user-select: none; white-space: nowrap;
  }

  /* ══════ SCROLL INDICATOR ══════ */
  #scroll-down {
    position: fixed; bottom: 1.45rem; left: 50%;
    transform: translateX(-50%);
    z-index: 50;
    display: flex; flex-direction: column;
    align-items: center; gap: 0.3rem;
    opacity: 0; transition: opacity 0.6s ease;
    cursor: pointer;
  }
  #scroll-down.visible { opacity: 1; pointer-events: auto; }
  #scroll-down span {
    font-size: calc(0.75rem * var(--size-scale)); font-weight: 300;
    letter-spacing: 0.2em; text-transform: none; color: #fff;
  }
  #scroll-down .chevron {
    width: 0.7rem; height: 0.7rem;
    stroke: #fff; stroke-width: 1.5; fill: none;
    stroke-linecap: round; stroke-linejoin: round;
    animation: float 2s ease-in-out infinite;
  }
  @keyframes float {
    0%, 100% { transform: translateY(0); opacity: 0.3; }
    50% { transform: translateY(0.2rem); opacity: 0.7; }
  }

  /* ══════ PEEK FILM STRIP (right) ══════ */
  #peek-strip {
    position: fixed;
    right: 0; top: 4rem; bottom: 4rem;
    z-index: 49;
    transform: translateX(100%);
    transition: transform 0.45s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.4s ease;
    opacity: 0;
    pointer-events: none;
    cursor: pointer;
  }
  #peek-strip.visible {
    transform: translateX(75%);
    opacity: 0.4;
    pointer-events: auto;
  }
  #peek-strip.visible:hover {
    transform: translateX(10%);
    opacity: 0.85;
  }
  #film-overlay.open ~ #peek-strip {
    opacity: 0 !important;
    pointer-events: none !important;
  }
  #peek-strip .film-body {
    height: 100%;
  }
  #peek-strip .film-frames {
    overflow: hidden;
  }
</style>
</head>
<body>
<script>
  document.documentElement.style.fontSize = (screen.width / 100) + 'px';
</script>

<div id="loader"><div class="pulse"></div></div>
<div id="slides-container"></div>

<div id="scroll-down">
  <span>scroll</span>
  <svg class="chevron" viewBox="0 0 24 24"><polyline points="6,9 12,15 18,9"/></svg>
</div>

<div id="counter">1 / 5</div>

<div id="leather-tab">
  <div class="tab-title">portfolio</div>
  <div class="tab-sub">tap to open menu</div>
</div>

<div id="settings-btn">
  <svg viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="3"/>
    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
  </svg>
</div>

<div id="settings-popup">
  <div class="setting-row">
    <span class="setting-label">font</span>
    <div class="setting-options">
      <button class="setting-btn active" data-setting="font" data-val="default">cormorant garamond</button>
      <button class="setting-btn" data-setting="font" data-val="atkinson">atkinson</button>
      <button class="setting-btn" data-setting="font" data-val="dyslexic">opendyslexic</button>
    </div>
  </div>
  <div class="setting-row">
    <span class="setting-label">size</span>
    <div class="setting-options">
      <button class="setting-btn" data-setting="fontsize" data-val="small">small</button>
      <button class="setting-btn active" data-setting="fontsize" data-val="medium">medium</button>
      <button class="setting-btn" data-setting="fontsize" data-val="large">large</button>
    </div>
  </div>
  <div class="setting-row">
    <span class="setting-label">language</span>
    <div class="setting-options">
      <button class="setting-btn active" data-setting="lang" data-val="en">english</button>
      <button class="setting-btn" data-setting="lang" data-val="pt">portugu&#234;s</button>
    </div>
  </div>
  <div class="setting-row">
    <span class="setting-label">photo resolution</span>
    <div class="setting-options">
      <button class="setting-btn" data-setting="res" data-val="low">low</button>
      <button class="setting-btn active" data-setting="res" data-val="default">default</button>
      <button class="setting-btn" data-setting="res" data-val="high">high</button>
    </div>
  </div>
</div>

<!-- Film overlay -->
<div id="film-overlay">
  <div class="backdrop" id="film-backdrop"></div>
  <div id="film-panel">
    <div id="film-content">
      <div id="categories-strip">
        <div class="film-body">
          <div class="sprockets" id="cat-sprockets-left"></div>
          <div class="film-edge-text">65mm &nbsp; portfolio &nbsp; index</div>
          <div class="cat-frames">
            <div class="cat-frame active" data-cat="main"><span class="cat-label">main</span></div>
            <div class="cat-frame" data-cat="portraits"><span class="cat-label">portraits</span></div>
            <div class="cat-frame" data-cat="landscapes"><span class="cat-label">landscapes</span></div>
          </div>
          <div class="film-edge-text">&#9650; &nbsp; roll &nbsp; 01</div>
          <div class="sprockets" id="cat-sprockets-right"></div>
        </div>
      </div>
      <div id="film-strip">
        <div class="film-body">
          <div class="sprockets" id="sprockets-left"></div>
          <div class="film-edge-text">65mm &nbsp; kodak &nbsp; 5219 &nbsp; vis3</div>
          <div class="film-frames" id="film-frames"></div>
          <div class="film-edge-text">&#9650; &nbsp; 28 &nbsp; &#9650; &nbsp; 28a &nbsp; &#9650; &nbsp; 29</div>
          <div class="sprockets" id="sprockets-right"></div>
        </div>
      </div>
    </div>
    <div id="film-canister">
      <div class="canister-cap top"></div>
      <div class="canister-body"><span class="canister-label">65mm &bull; kodak</span></div>
      <div class="canister-cap bottom"></div>
    </div>
  </div>
</div>

<div id="lorem-window">
  <h2>about</h2>
  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
  <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
  <p>Curabitur pretium tincidunt lacus. Nulla gravida orci a odio. Nullam varius, turpis et commodo pharetra, est eros bibendum elit, nec luctus magna felis sollicitudin mauris.</p>
</div>

<div id="resize-group">
  <div id="crop-preview">
    <div class="photo-full" id="photo-full"><img id="crop-img-dim" /></div>
    <div class="viewport-crop" id="viewport-crop"><img id="crop-img-bright" /></div>
    <span class="ratio-label" id="photo-ratio-label"></span>
  </div>
  <span class="label" id="hint-label"></span>
</div>

<!-- Peek strip (right) -->
<div id="peek-strip">
  <div class="film-body">
    <div class="sprockets" id="peek-sprockets-left"></div>
    <div class="film-frames" id="peek-frames"></div>
    <div class="sprockets" id="peek-sprockets-right"></div>
  </div>
</div>

<!-- Sound placeholder -->
<audio id="shutter-sound" preload="none"></audio>

<script>
(function() {
  /* ══════ DATA ══════ */
  var resMap = { low: 800, default: 2400, high: 4000 };
  var currentRes = 'default';

  function imgUrl(base, res) {
    return base.replace(/w=\d+/, 'w=' + resMap[res]);
  }

  var categories = {
    main: [
      { base: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=2400&q=85&fit=crop&ar=3:2', alt: 'Mountain landscape', lens: '35mm f1.4', sensor: 'APS-C', date: '03/15/2023' },
      { base: 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=2400&q=85&fit=crop&ar=3:2', alt: 'Forest valley', lens: '35mm f1.4', sensor: 'APS-C', date: '06/22/2023' },
      { base: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=1600&q=85&fit=crop&ar=2:3', alt: 'Portrait', lens: '35mm f1.4', sensor: 'APS-C', date: '09/10/2023', portrait: true },
      { base: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=2400&q=85&fit=crop&ar=3:2', alt: 'Golden hills', lens: '35mm f1.4', sensor: 'APS-C', date: '11/03/2023' },
      { base: 'https://images.unsplash.com/photo-1433086966358-54859d0ed716?w=2400&q=85&fit=crop&ar=3:2', alt: 'Waterfall bridge', lens: '35mm f1.4', sensor: 'APS-C', date: '12/28/2023' },
    ],
    portraits: [
      { base: 'https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=1600&q=85&fit=crop&ar=2:3', alt: 'Portrait studio', lens: '35mm f1.4', sensor: 'APS-C', date: '01/14/2024', portrait: true },
      { base: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=1600&q=85&fit=crop&ar=2:3', alt: 'Natural light', lens: '35mm f1.4', sensor: 'APS-C', date: '02/20/2024', portrait: true },
      { base: 'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=1600&q=85&fit=crop&ar=2:3', alt: 'Street portrait', lens: '35mm f1.4', sensor: 'APS-C', date: '04/05/2024', portrait: true },
    ],
    landscapes: [
      { base: 'https://images.unsplash.com/photo-1472214103451-9374bd1c798e?w=2400&q=85&fit=crop&ar=3:2', alt: 'Green hills', lens: '35mm f1.4', sensor: 'APS-C', date: '05/17/2024' },
      { base: 'https://images.unsplash.com/photo-1465056836900-8f1e940f1904?w=2400&q=85&fit=crop&ar=3:2', alt: 'Ocean sunset', lens: '35mm f1.4', sensor: 'APS-C', date: '07/09/2024' },
      { base: 'https://images.unsplash.com/photo-1426604966848-d7adac402bff?w=2400&q=85&fit=crop&ar=3:2', alt: 'Mountain forest', lens: '35mm f1.4', sensor: 'APS-C', date: '08/30/2024' },
    ]
  };

  var heroPhotoUrls = [
    'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&q=60&fit=crop',
    'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=400&q=60&fit=crop',
    'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&q=60&fit=crop',
    'https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=400&q=60&fit=crop',
    'https://images.unsplash.com/photo-1433086966358-54859d0ed716?w=400&q=60&fit=crop',
    'https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=400&q=60&fit=crop',
    'https://images.unsplash.com/photo-1472214103451-9374bd1c798e?w=400&q=60&fit=crop',
    'https://images.unsplash.com/photo-1465056836900-8f1e940f1904?w=400&q=60&fit=crop',
  ];

  /* ══════ DOM REFS ══════ */
  var loader = document.getElementById('loader');
  var slidesContainer = document.getElementById('slides-container');
  var counterEl = document.getElementById('counter');
  var scrollInd = document.getElementById('scroll-down');
  var leatherTab = document.getElementById('leather-tab');
  var tabSub = leatherTab.querySelector('.tab-sub');
  var settingsBtn = document.getElementById('settings-btn');
  var settingsPopup = document.getElementById('settings-popup');
  var filmOvl = document.getElementById('film-overlay');
  var filmBkdp = document.getElementById('film-backdrop');
  var filmPanel = document.getElementById('film-panel');
  var filmFramesEl = document.getElementById('film-frames');
  var filmCanister = document.getElementById('film-canister');
  var loremWindow = document.getElementById('lorem-window');
  var resizeGroup = document.getElementById('resize-group');
  var hintLabel = document.getElementById('hint-label');
  var cropPreview = document.getElementById('crop-preview');
  var photoFullEl = document.getElementById('photo-full');
  var vpCropEl = document.getElementById('viewport-crop');
  var cropDimImg = document.getElementById('crop-img-dim');
  var cropBrightImg = document.getElementById('crop-img-bright');
  var photoRatioLbl = document.getElementById('photo-ratio-label');
  var peekStrip = document.getElementById('peek-strip');
  var peekFrames = document.getElementById('peek-frames');

  /* ══════ STATE ══════ */
  var currentCat = 'main';
  var slides = [], slideImages = [], total = 0;
  var loadedCount = 0, firstLoaded = false, activeIndex = -1;
  var filmMenuOpen = false;
  var hasHero = true;
  var sw = screen.width;

  /* ══════ IMAGE SIZING ══════ */
  function containSize(nw, nh, bw, bh) {
    var s = Math.min(bw/nw, bh/nh);
    return { w: Math.round(nw*s), h: Math.round(nh*s) };
  }
  function coverSize(nw, nh, bw, bh) {
    var s = Math.max(bw/nw, bh/nh);
    return { w: Math.round(nw*s), h: Math.round(nh*s) };
  }
  function setSmall(img) {
    var nw = img.naturalWidth||3, nh = img.naturalHeight||2;
    var s = containSize(nw, nh, window.innerWidth*0.8, window.innerHeight*0.8);
    img.style.width = s.w+'px'; img.style.height = s.h+'px';
  }
  function setExpand(img) {
    var nw = img.naturalWidth||3, nh = img.naturalHeight||2;
    var s = coverSize(nw, nh, window.innerWidth, window.innerHeight);
    img.style.width = s.w+'px'; img.style.height = s.h+'px';
  }

  /* ══════ BUILD SLIDES ══════ */
  function buildSlides(catKey) {
    currentCat = catKey;
    var photos = categories[catKey];
    var isMain = (catKey === 'main');
    activeIndex = -1; loadedCount = 0; firstLoaded = false;
    slidesContainer.innerHTML = '';
    loader.classList.remove('hidden');
    scrollInd.classList.remove('visible');
    window.scrollTo({ top: 0, behavior: 'auto' });

    // Hero slide only for main
    if (isMain) {
      var hero = document.createElement('div');
      hero.className = 'slide hero-slide';
      var grid = document.createElement('div');
      grid.className = 'hero-grid';
      for (var g = 0; g < 30; g++) {
        var gi = document.createElement('img');
        gi.src = heroPhotoUrls[g % heroPhotoUrls.length];
        gi.style.animationDelay = (g * 40) + 'ms';
        gi.alt = '';
        grid.appendChild(gi);
      }
      hero.appendChild(grid);
      var overlay = document.createElement('div');
      overlay.className = 'hero-overlay';
      hero.appendChild(overlay);
      var vig = document.createElement('div');
      vig.className = 'vignette';
      vig.style.opacity = '1';
      hero.appendChild(vig);
      var heroText = document.createElement('div');
      heroText.className = 'hero-text';
      heroText.innerHTML = '<h1>portfolio</h1><p>photography collection</p>';
      hero.appendChild(heroText);
      slidesContainer.appendChild(hero);
    }

    // Photo slides
    for (var i = 0; i < photos.length; i++) {
      var p = photos[i];
      var slide = document.createElement('div');
      slide.className = 'slide';
      var img = document.createElement('img');
      img.className = 'main-photo';
      img.src = imgUrl(p.base, currentRes);
      img.alt = p.alt;
      img.crossOrigin = 'anonymous';
      slide.appendChild(img);
      var v = document.createElement('div');
      v.className = 'vignette';
      slide.appendChild(v);

      // Photo info
      var info = document.createElement('div');
      info.className = 'photo-info';
      var photoSrc = imgUrl(p.base, 'low');
      info.innerHTML =
        '<img class="hover-photo" src="media/f095.png" data-for="lens" />' +
        '<img class="hover-photo" src="media/a6400.png" data-for="sensor" />' +
        '<div class="info-line hoverable" data-hover="lens" data-base="'+p.lens+'" data-ext=" to f/16 - 7artisans">' + p.lens + '<span class="extra-text"></span></div>' +
        '<div class="info-line hoverable" data-hover="sensor" data-base="'+p.sensor+'" data-ext=" Sony a6400">' + p.sensor + '<span class="extra-text"></span></div>' +
        '<div class="info-line date-line" data-year="'+p.date.split('/')[2]+'" data-full="'+p.date+'">' + p.date.split('/')[2] + '</div>';
      slide.appendChild(info);
      slidesContainer.appendChild(slide);
    }

    total = photos.length + (isMain ? 1 : 0);
    slides = slidesContainer.querySelectorAll('.slide');
    slideImages = slidesContainer.querySelectorAll('.slide img.main-photo');
    counterEl.textContent = '';

    // Setup hover on info lines
    setupInfoHovers();

    // Load handlers
    slideImages.forEach(function(img) {
      if (img.complete && img.naturalWidth > 0) onImgLoad(img);
      else {
        img.addEventListener('load', function() { onImgLoad(img); });
        img.addEventListener('error', function() { loadedCount++; if(!firstLoaded){firstLoaded=true;loader.classList.add('hidden');} });
      }
    });

    // Hero loads fast, just hide loader
    if (slideImages.length === 0) {
      loader.classList.add('hidden');
      firstLoaded = true;
    }
    setTimeout(function() {
      loader.classList.add('hidden');
      firstLoaded = true;
      scrollInd.classList.add('visible');
      activateSlide(0);
    }, 500);

    buildFilmFrames(catKey);
    buildPeekFrames(catKey);
  }

  function onImgLoad(img) {
    setSmall(img);
    img.classList.add('loaded');
    loadedCount++;
    if (!firstLoaded) {
      firstLoaded = true;
      loader.classList.add('hidden');
      scrollInd.classList.add('visible');
      updateRatio();
    }
  }

  /* ══════ ACTIVATE SLIDE ══════ */
  function activateSlide(idx) {
    if (idx === activeIndex) return;
    activeIndex = idx;
    var isMain = (currentCat === 'main');
    var isHero = isMain && (idx === 0);

    for (var i = 0; i < slides.length; i++) {
      var img = slides[i].querySelector('img.main-photo');
      if (!img) {
        // hero slide — toggle active class only
        slides[i].classList.toggle('active', i === idx);
        continue;
      }
      if (i === idx) {
        img.classList.add('expand');
        setExpand(img);
        slides[i].classList.add('active');
      } else {
        img.classList.remove('expand');
        setSmall(img);
        slides[i].classList.remove('active');
      }
    }

    // Counter
    if (isHero) {
      counterEl.textContent = '';
    } else if (isMain) {
      counterEl.textContent = idx + ' / ' + (total - 1);
    } else {
      counterEl.textContent = (idx + 1) + ' / ' + total;
    }

    // Frosted glass on corners for hero
    counterEl.classList.toggle('frosted', isHero);
    settingsBtn.classList.toggle('frosted', isHero);

    // Resize group: hide on hero
    updateRatio();

    if (filmMenuOpen) updateFilmHighlight();
    updatePeekHighlight();
  }

  /* ══════ SCROLL ══════ */
  var scrollTimer = null;
  function onScroll() {
    var st = document.documentElement.scrollTop || document.body.scrollTop;
    var vh = window.innerHeight;
    var nearest = Math.round(st / vh);
    nearest = Math.max(0, Math.min(nearest, total - 1));

    var isMain = (currentCat === 'main');
    if (isMain && nearest === 0) counterEl.textContent = '';
    else if (isMain) counterEl.textContent = nearest + ' / ' + (total - 1);
    else counterEl.textContent = (nearest + 1) + ' / ' + total;

    clearTimeout(scrollTimer);
    scrollTimer = setTimeout(function() {
      var s = document.documentElement.scrollTop || document.body.scrollTop;
      var snapped = Math.round(s / vh);
      snapped = Math.max(0, Math.min(snapped, total - 1));
      activateSlide(snapped);
    }, 80);

    if (st > vh * 0.15) scrollInd.classList.remove('visible');
    else if (firstLoaded) scrollInd.classList.add('visible');
  }

  window.addEventListener('scroll', function() { requestAnimationFrame(onScroll); }, { passive: true });

  // Scroll indicator click → scroll to next slide
  scrollInd.addEventListener('click', function() {
    var st = document.documentElement.scrollTop || document.body.scrollTop;
    var vh = window.innerHeight;
    var current = Math.round(st / vh);
    var next = Math.min(current + 1, total - 1);
    window.scrollTo({ top: vh * next, behavior: 'smooth' });
  });

  window.addEventListener('resize', function() {
    for (var i = 0; i < slides.length; i++) {
      var img = slides[i].querySelector('img.main-photo');
      if (!img) continue;
      if (i === activeIndex) setExpand(img);
      else setSmall(img);
    }
    updateRatio();
  });

  /* ══════ FILM STRIP ══════ */
  function buildCatSprockets() {
    var el = ['cat-sprockets-left','cat-sprockets-right'];
    el.forEach(function(id) {
      var c = document.getElementById(id);
      if (c.children.length > 0) return;
      for (var i = 0; i < 20; i++) {
        var s = document.createElement('div'); s.className = 'sprocket'; c.appendChild(s);
      }
    });
  }

  function fillSprockets(id, n) {
    var c = document.getElementById(id); c.innerHTML = '';
    for (var i = 0; i < n; i++) {
      var s = document.createElement('div'); s.className = 'sprocket'; c.appendChild(s);
    }
  }

  function buildFilmFrames(catKey) {
    filmFramesEl.innerHTML = '';
    fillSprockets('sprockets-left', 40);
    fillSprockets('sprockets-right', 40);
    var photos = categories[catKey];

    // Hero frame only for main
    if (catKey === 'main') {
      var hf = document.createElement('div'); hf.className = 'film-frame hero-thumb';
      var ht = document.createElement('img');
      ht.src = heroPhotoUrls[0]; ht.alt = 'hero';
      ht.style.filter = 'grayscale(1)';
      hf.appendChild(ht);
      var hn = document.createElement('span'); hn.className = 'frame-num';
      hn.textContent = '0'; hf.appendChild(hn);
      hf.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      filmFramesEl.appendChild(hf);
    }

    var heroOffset = (catKey === 'main') ? 1 : 0;
    for (var i = 0; i < photos.length; i++) {
      var f = document.createElement('div'); f.className = 'film-frame';
      var t = document.createElement('img');
      t.src = imgUrl(photos[i].base, 'low'); t.alt = photos[i].alt;
      f.appendChild(t);
      var n = document.createElement('span'); n.className = 'frame-num';
      n.textContent = (i+1); f.appendChild(n);
      f.setAttribute('data-index', i);
      f.addEventListener('click', (function(idx, off) {
        return function() {
          window.scrollTo({ top: window.innerHeight * (idx + off), behavior: 'smooth' });
        };
      })(i, heroOffset));
      filmFramesEl.appendChild(f);
    }
    if (filmMenuOpen) updateFilmHighlight();
  }

  function updateFilmHighlight() {
    var frames = filmFramesEl.querySelectorAll('.film-frame');
    for (var i = 0; i < frames.length; i++) {
      frames[i].classList.toggle('current', i === activeIndex);
    }
  }

  /* ══════ PEEK STRIP ══════ */
  function buildPeekFrames(catKey) {
    peekFrames.innerHTML = '';
    fillSprockets('peek-sprockets-left', 30);
    fillSprockets('peek-sprockets-right', 30);
    var photos = categories[catKey];
    var isMain = (catKey === 'main');

    // Frame 0: hero for main, back button for others
    var hf = document.createElement('div'); hf.className = 'film-frame hero-thumb';
    var ht = document.createElement('img');
    ht.src = isMain ? heroPhotoUrls[0] : 'back.jpg';
    ht.alt = isMain ? 'hero' : 'back to main';
    if (isMain) ht.style.filter = 'grayscale(1)';
    hf.appendChild(ht);
    var hn = document.createElement('span'); hn.className = 'frame-num';
    hn.textContent = '0'; hf.appendChild(hn);
    hf.addEventListener('click', function(e) {
      e.stopPropagation();
      if (!isMain) {
        // Switch to main category
        document.querySelectorAll('.cat-frame').forEach(function(c) { c.classList.remove('active'); });
        document.querySelector('.cat-frame[data-cat="main"]').classList.add('active');
        buildSlides('main');
      } else {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    });
    peekFrames.appendChild(hf);

    var heroOffset = isMain ? 1 : 0;
    for (var i = 0; i < photos.length; i++) {
      var f = document.createElement('div'); f.className = 'film-frame';
      var t = document.createElement('img');
      t.src = imgUrl(photos[i].base, 'low'); t.alt = photos[i].alt;
      f.appendChild(t);
      var n = document.createElement('span'); n.className = 'frame-num';
      n.textContent = (i+1); f.appendChild(n);
      f.addEventListener('click', (function(idx, off) {
        return function(e) {
          e.stopPropagation();
          window.scrollTo({ top: window.innerHeight * (idx + off), behavior: 'smooth' });
        };
      })(i, heroOffset));
      peekFrames.appendChild(f);
    }
  }

  function updatePeekHighlight() {
    var frames = peekFrames.querySelectorAll('.film-frame');
    var isMain = (currentCat === 'main');
    for (var i = 0; i < frames.length; i++) {
      if (isMain) {
        frames[i].classList.toggle('current', i === activeIndex);
      } else {
        // frame 0 = back button, frame 1+ = photos
        frames[i].classList.toggle('current', i === activeIndex + 1);
      }
    }
  }

  // Peek strip: clicking non-frame areas opens menu
  peekStrip.addEventListener('click', function(e) {
    if (!e.target.closest('.film-frame') && !filmMenuOpen) toggleFilmMenu();
  });

  // Peek strip: show on scroll briefly or mouse near right edge
  var peekScrollTimer = null;
  function showPeekBriefly() {
    peekStrip.classList.add('visible');
    clearTimeout(peekScrollTimer);
    peekScrollTimer = setTimeout(function() {
      peekStrip.classList.remove('visible');
    }, 1200);
  }

  window.addEventListener('scroll', function() {
    showPeekBriefly();
  }, { passive: true });

  document.addEventListener('mousemove', function(e) {
    if (e.clientX > window.innerWidth * 0.92) {
      clearTimeout(peekScrollTimer);
      peekStrip.classList.add('visible');
    } else {
      peekStrip.classList.remove('visible');
    }
  });

  /* ══════ FILM MENU TOGGLE ══════ */
  function toggleFilmMenu() {
    filmMenuOpen = !filmMenuOpen;
    filmOvl.classList.toggle('open', filmMenuOpen);
    loremWindow.classList.toggle('open', filmMenuOpen);
    settingsPopup.classList.toggle('open', filmMenuOpen);
    tabSub.textContent = filmMenuOpen ? 'tap to close' : 'tap to open menu';

    if (filmMenuOpen) {
      filmCanister.classList.add('visible');
      setTimeout(function() {
        filmPanel.classList.add('animate-in');
      }, 200);
      updateFilmHighlight();
    } else {
      filmPanel.classList.remove('animate-in');
      setTimeout(function() {
        filmCanister.classList.remove('visible');
      }, 400);
    }
  }

  leatherTab.addEventListener('click', toggleFilmMenu);
  settingsBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    toggleFilmMenu();
  });
  filmBkdp.addEventListener('click', function() { if (filmMenuOpen) toggleFilmMenu(); });

  // Category clicks
  document.querySelectorAll('.cat-frame').forEach(function(cf) {
    cf.addEventListener('click', function() {
      var cat = cf.getAttribute('data-cat');
      if (cat === currentCat) return;
      document.querySelectorAll('.cat-frame').forEach(function(c) { c.classList.remove('active'); });
      cf.classList.add('active');
      if (filmMenuOpen) toggleFilmMenu();
      buildSlides(cat);
    });
  });

  /* ══════ SETTINGS ══════ */

  document.querySelectorAll('.setting-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var setting = btn.getAttribute('data-setting');
      var val = btn.getAttribute('data-val');
      // Update active button in group
      btn.parentElement.querySelectorAll('.setting-btn').forEach(function(b) { b.classList.remove('active'); });
      btn.classList.add('active');

      if (setting === 'font') {
        document.documentElement.setAttribute('data-font', val);
      } else if (setting === 'fontsize') {
        document.documentElement.setAttribute('data-fontsize', val);
      } else if (setting === 'lang') {
        // placeholder
      } else if (setting === 'res') {
        currentRes = val;
        buildSlides(currentCat);
      }
    });
  });

  /* ══════ RESIZE HINT + CROP PREVIEW ══════ */
  var TOLERANCE = 0.06;

  function getTargetRatio() {
    if (activeIndex <= 0 || !slides[activeIndex]) return 3/2;
    var img = slides[activeIndex].querySelector('img.main-photo');
    if (!img) return 3/2;
    return (img.naturalWidth||3) / (img.naturalHeight||2);
  }

  function gcd(a,b) { return b===0?a:gcd(b,a%b); }
  function niceRatio(w,h) {
    var g = gcd(Math.round(w),Math.round(h));
    var rw = Math.round(w/g), rh = Math.round(h/g);
    if (rw>30||rh>30) {
      var r = w/h;
      var c = [[16,9],[16,10],[21,9],[4,3],[3,2],[2,3],[3,4],[1,1],[9,16]];
      for (var i=0;i<c.length;i++) { if(Math.abs(r-c[i][0]/c[i][1])<0.05) return c[i][0]+':'+c[i][1]; }
    }
    return rw+':'+rh;
  }

  function updateRatio() {
    // Hide on hero (main only)
    if (currentCat === 'main' && activeIndex === 0) {
      resizeGroup.classList.remove('visible');
      return;
    }
    var target = getTargetRatio();
    var ratio = window.innerWidth / window.innerHeight;
    var diff = ratio - target;
    if (Math.abs(diff) < TOLERANCE) {
      resizeGroup.classList.remove('visible');
      return;
    }
    resizeGroup.classList.add('visible');

    if (diff > 0) {
      hintLabel.innerHTML = 'shrink horizontally \u2194<br>or expand vertically \u2195';
    } else {
      hintLabel.innerHTML = 'expand horizontally \u2194<br>or shrink vertically \u2195';
    }

    updateCropPreview();
  }

  function updateCropPreview() {
    if (activeIndex <= 0 || !slides[activeIndex]) return;
    var img = slides[activeIndex].querySelector('img.main-photo');
    if (!img) return;
    var nw = img.naturalWidth||3, nh = img.naturalHeight||2;
    var vpW = window.innerWidth, vpH = window.innerHeight;
    var pr = nw/nh, vr = vpW/vpH;
    var box = sw * 0.07;

    var pW, pH;
    if (pr > 1) { pW = box; pH = box/pr; }
    else { pH = box; pW = box*pr; }

    var vW, vH;
    if (vr > pr) { vW = pW; vH = pW/vr; }
    else { vH = pH; vW = pH*vr; }

    var mW = Math.max(pW,vW), mH = Math.max(pH,vH);
    cropPreview.style.width = mW+'px';
    cropPreview.style.height = mH+'px';

    cropDimImg.src = img.src;
    cropBrightImg.src = img.src;

    var pL=(mW-pW)/2, pT=(mH-pH)/2;
    photoFullEl.style.width=pW+'px'; photoFullEl.style.height=pH+'px';
    photoFullEl.style.left=pL+'px'; photoFullEl.style.top=pT+'px';

    var vL=(mW-vW)/2, vT=(mH-vH)/2;
    vpCropEl.style.width=vW+'px'; vpCropEl.style.height=vH+'px';
    vpCropEl.style.left=vL+'px'; vpCropEl.style.top=vT+'px';

    cropBrightImg.style.width=pW+'px'; cropBrightImg.style.height=pH+'px';
    cropBrightImg.style.left=(pL-vL)+'px'; cropBrightImg.style.top=(pT-vT)+'px';

    photoRatioLbl.textContent = niceRatio(nw,nh) + ' photo';
    photoRatioLbl.style.left = pL+'px';
    photoRatioLbl.style.top = (pT - sw*0.01) + 'px';
  }

  // Hint label hover → show crop preview
  hintLabel.addEventListener('mouseenter', function() {
    resizeGroup.classList.add('show-preview');
  });
  hintLabel.addEventListener('mouseleave', function() {
    resizeGroup.classList.remove('show-preview');
  });

  /* ══════ PHOTO INFO HOVER ══════ */
  var months = ['january','february','march','april','may','june','july','august','september','october','november','december'];

  function setupInfoHovers() {
    document.querySelectorAll('.info-line.hoverable').forEach(function(line) {
      line.addEventListener('mouseenter', function() {
        line.classList.add('hovered');
        var ext = line.querySelector('.extra-text');
        if (ext) ext.textContent = line.getAttribute('data-ext');
        var info = line.closest('.photo-info');
        if (!info) return;
        var hoverType = line.getAttribute('data-hover');
        info.querySelectorAll('.hover-photo').forEach(function(img) {
          img.classList.toggle('show', img.getAttribute('data-for') === hoverType);
        });
      });
      line.addEventListener('mouseleave', function() {
        line.classList.remove('hovered');
        var info = line.closest('.photo-info');
        if (!info) return;
        info.querySelectorAll('.hover-photo').forEach(function(img) {
          img.classList.remove('show');
        });
      });
    });

    document.querySelectorAll('.date-line').forEach(function(line) {
      line.style.cursor = 'pointer';
      line.addEventListener('mouseenter', function() {
        var full = line.getAttribute('data-full');
        var parts = full.split('/');
        var m = parseInt(parts[0], 10) - 1;
        line.textContent = parts[2] + ' ' + months[m] + ' ' + parts[1];
      });
      line.addEventListener('mouseleave', function() {
        line.textContent = line.getAttribute('data-year');
      });
    });
  }

  /* ══════ SOUND ══════ */
  function playSound() {
    var audio = document.getElementById('shutter-sound');
    if (audio.src) { audio.currentTime = 0; audio.play().catch(function(){}); }
  }

  /* ══════ INIT ══════ */
  buildCatSprockets();
  buildSlides('main');
})();
</script>
</body>
</html>