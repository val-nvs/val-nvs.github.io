<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Val-Stats: Personal Contribution Tracker</title>
<script type="module">
import{initializeApp as t}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import{getAuth as e,signInWithPopup as a,GoogleAuthProvider as i,signOut as n,onAuthStateChanged as s}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";import{getFirestore as o,doc as r,collection as d,query as l,onSnapshot as c,where as m,getDocs as u,writeBatch as p}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";const h={apiKey:"AIzaSyC4CEh7zUm8QbMZzrNMaC_jEhHioyMhksI",authDomain:"val-stats-6e421.firebaseapp.com",projectId:"val-stats-6e421",storageBucket:"val-stats-6e421.firebasestorage.app",messagingSenderId:"1054962717828",appId:"1:1054962717828:web:df1b68c6d2b8d14bc41ed1",measurementId:"G-PS5RK92NV9"},g=t(h),f=e(g),y=o(g),v=new i,b="val-stats-tracker";window.db=y,window.auth=f,window.appId=b,window.dataLoaded=!1,window.aggregatedData={},window.getPaths=t=>({userEntriesCollection:`artifacts/${b}/users/${t}/entries`,publicStatsCollection:`artifacts/${b}/public/data/daily_stats`}),window.dateToDays=t=>{const e=new Date(t),a=new Date("1970-01-01");return Math.floor((e-a)/864e5)},window.getTodayDate=()=>(new Date).toISOString().slice(0,10),window.handleSignIn=async()=>{try{const t=await a(f,v);console.log("Signed in successfully:",t.user.uid)}catch(t){console.error("Google Sign-In Error:",t.message),window.showToast("Sign-In failed.","error")}},window.handleSignOut=()=>{n(f).then(()=>{console.log("Signed out."),window.showToast("Signed out successfully.","success")}).catch(t=>{console.error("Sign-Out Error:",t)})};const w=(t,e)=>{if("movie"===e){if(t>=120)return 4;if(t>=60)return 3;if(t>=30)return 2;if(t>0)return 1;return 0}let a=[15,30,45,60];return t>=a[3]?4:t>=a[2]?3:t>=a[1]?2:t>=a[0]?1:0},D=t=>{const e=new Date,a=new Date(e.getFullYear(),0,1),i=new Date(a);i.setDate(a.getDate()-a.getDay());const n={["grid-container-1"]:{type:"github",label:"GitHub Contributions"},["grid-container-3"]:{type:"movie",label:"Movies Watched in Minutes"},["grid-container-2"]:{type:"book",label:"Books in Time Minutes"}};Object.keys(n).forEach(e=>{const{type:a}=n[e],s=document.getElementById(e);if(!s)return;s.innerHTML="";for(let e=0;e<52;e++)for(let n=0;n<7;n++){const o=new Date(i);o.setDate(i.getDate()+7*e+n);const d=o.toISOString().slice(0,10),l=t[d];let c=0,m=d+"\nActivity: 0";if("github"===a)c=Math.floor(5*Math.random()),m=`${d}\nActivity: ${c} (Simulated GitHub)`;else if(l){const t=l[a]||0;c=w(t,a),m=`${d}\n${a.charAt(0).toUpperCase()+a.slice(1)} Time: ${t} mins`,"movie"===a&&l.movieDetails&&(m+=`\nDetails: ${l.movieDetails}`)}const u=document.createElement("div");u.className=`grid-cell cell-${c}`,u.title=m,s.appendChild(u)}})};window.setupPublicListener=()=>{const t=d(y,`artifacts/${b}/public/data/daily_stats`);c(t,t=>{const e={};t.forEach(t=>{const a=t.data();e[a.date]=a}),window.aggregatedData=e,window.dataLoaded=!0,D(window.aggregatedData),Object.keys(e).length>0&&window.showToast("Stats loaded!","success")},t=>{console.error("Error listening to public stats:",t),window.showToast("Failed to load stats.","error")})},window.handleEntrySubmission=async()=>{if(!f.currentUser)return void window.showToast("You must be logged in to submit data.","error");const t=document.getElementById("entry-type").value,e=document.getElementById("entry-title").value.trim(),a=parseInt(document.getElementById("entry-duration").value),i=document.getElementById("entry-director").value.trim(),n=parseFloat(document.getElementById("entry-rating").value),s=document.getElementById("entry-letterboxd").value.trim(),o=document.getElementById("entry-theater").checked,c=document.getElementById("entry-date").value;if(!e||isNaN(a)||!c)return void window.showToast("Please fill in required fields (Title, Duration, Date).","error");const h={type:t,title:e,duration:a,date:c,timestamp:new Date,rating:isNaN(n)?null:n};"movie"===t&&(h.watchedInTheater=o,h.director=i||"N/A",h.letterboxdId=s||null);const g=f.currentUser.uid,{userEntriesCollection:v,publicStatsCollection:b}=window.getPaths(g),w=p(y);try{const n=r(d(y,v));w.set(n,h);const s=r(y,b,c),o=await u(l(d(y,v),m("date","==",c)));let p=0,g=0,D=new Set,I=[];o.forEach(t=>{const e=t.data();"movie"===e.type?(p+=e.duration,e.director&&D.add(e.director),I.push(`[${e.director}] ${e.title} (${e.rating||"N/A"}★)`)):"book"===e.type&&(g+=e.duration)}),"movie"===t?(p+=a,i&&D.add(i),I.push(`[${i||"N/A"}] ${e} (${n||"N/A"}★)`)):g+=a,w.set(s,{date:c,movie:p,book:g,movies_directors:Array.from(D),movieDetails:I.join(" | ")},{merge:!0}),await w.commit(),document.getElementById("entry-form").reset(),document.getElementById("entry-date").value=window.getTodayDate(),window.showToast("Entry submitted successfully!","success")}catch(t){console.error("Submission Error:",t),window.showToast(`Submission failed: ${t.message}`,"error")}};const I=()=>{};window.applyDirectorFilter=t=>{},window.showToast=(t,e="info")=>{const a=document.getElementById("toast-message");a.textContent=t,a.className="toast show "+e,setTimeout(()=>{a.className=a.className.replace("show","")},3e3)},s(f,t=>{const e=document.getElementById("login-section"),a=document.getElementById("data-entry-section"),i=document.getElementById("entry-container");t?(e.style.display="none",a.style.display="block",i.style.display="block",document.getElementById("user-email").textContent=t.email||t.uid):(e.style.display="block",a.style.display="none",i.style.display="none"),window.dataLoaded||window.setupPublicListener()}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("entry-date").value=window.getTodayDate()});
</script>
<style>
:root{--color-cell-0:#161b22;--color-cell-1:#0e4429;--color-cell-2:#006d32;--color-cell-3:#26a641;--color-cell-4:#39d353;--color-bg-dark:#0a0a0a;--color-bg-mid:#1f2937;--color-bg-light:#374151;--color-text:#f3f4f6;--color-primary:#39d353;--color-error:#ef4444;--color-success:#10b981}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background-color:var(--color-bg-dark);color:var(--color-text);margin:0;padding:0;min-height:100vh;display:flex;flex-direction:column;align-items:center}.main-container{width:95%;max-width:1200px;padding:2rem 0}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;padding:0 1rem}.header h1{font-size:2.5rem;font-weight:800;color:var(--color-primary);visibility:hidden}.auth-controls{display:flex;align-items:center;gap:1rem}.input-group{display:flex;flex-direction:column;margin-bottom:1rem;flex-grow:1}.input-grid{display:flex;gap:1rem;flex-wrap:wrap}label{margin-bottom:.25rem;font-size:.875rem;color:var(--color-text)}input[type="text"],input[type="number"],input[type="date"],select{padding:.5rem;border-radius:.375rem;border:1px solid var(--color-bg-light);background-color:var(--color-bg-mid);color:var(--color-text);transition:border-color .2s;min-width:150px}input[type="text"]:focus,input[type="number"]:focus,input[type="date"]:focus,select:focus{border-color:var(--color-primary);outline:none}.checkbox-group{display:flex;align-items:center;margin-top:1.5rem;gap:.5rem}button{padding:.75rem 1.5rem;border-radius:.5rem;font-weight:600;cursor:pointer;transition:background-color .2s,transform .1s;border:none}.btn-primary{background-color:#2d3748;color:#9ca3af;font-size:.75rem;padding:.5rem 1rem;border:1px solid #1f2937}.btn-primary:hover{background-color:#374151}.btn-secondary{background-color:var(--color-bg-light);color:var(--color-text)}.btn-secondary:hover{background-color:#4b5563}.section-box{background-color:var(--color-bg-mid);border-radius:.75rem;padding:2rem;margin-bottom:2rem;border:1px solid var(--color-bg-light)}.section-box h3{font-size:1.5rem;font-weight:700;margin-top:0;margin-bottom:1.5rem;color:var(--color-primary)}.grid-section{width:100%;padding:2.5rem 0;background-color:var(--color-bg-mid);display:flex;justify-content:center;border-bottom:1px solid var(--color-bg-light);margin-top:1rem}.grid-content-box{box-shadow:0 5px 10px rgba(0,0,0,.5);border-radius:.5rem;padding:1rem;background-color:var(--color-bg-dark);border:1px solid var(--color-bg-light);width:fit-content;display:flex;flex-direction:column;align-items:center}.grid-title{font-size:1.5rem;font-weight:700;margin-bottom:1rem;text-align:center}.grid-container{display:grid;grid-template-columns:repeat(53,12px);grid-template-rows:repeat(7,12px);gap:2px;width:fit-content;max-width:none;grid-auto-flow:column}.grid-cell{border-radius:2px;transition:background-color .15s ease-in-out}.grid-cell.cell-0{background-color:var(--color-cell-0)}.grid-cell.cell-1{background-color:var(--color-cell-1)}.grid-cell.cell-2{background-color:var(--color-cell-2)}.grid-cell.cell-3{background-color:var(--color-cell-3)}.grid-cell.cell-4{background-color:var(--color-cell-4)}.hue-shift-plus{filter:hue-rotate(120deg)}.hue-shift-minus{filter:hue-rotate(-120deg)}.toast{visibility:hidden;min-width:250px;margin-left:-125px;background-color:#333;color:#fff;text-align:center;border-radius:2px;padding:16px;position:fixed;z-index:100;left:50%;bottom:30px;font-size:17px;transition:opacity .3s,background-color .3s;opacity:0}.toast.show{visibility:visible;animation:fadein .5s,fadeout .5s 2.5s;opacity:1}.toast.error{background-color:var(--color-error)}.toast.success{background-color:var(--color-success)}@keyframes fadein{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}@keyframes fadeout{from{opacity:1}to{opacity:0}}@media (max-width:768px){.header h1{font-size:1.8rem}.input-grid{flex-direction:column}.grid-content-box{width:95%}.grid-title{font-size:1.2rem}.grid-container{grid-template-columns:repeat(53,6px);grid-template-rows:repeat(7,6px);gap:1px}}
</style>
</head>
<body>
<div id="toast-message" class="toast"></div>
<div class="main-container">
<header class="header">
<h1>Val-Stats</h1>
<div class="auth-controls">
<div id="data-entry-section" style="display:none;" class="auth-controls">
<span id="user-email"></span>
<button onclick="handleSignOut()" class="btn-secondary">Sign Out</button>
</div>
<div id="login-section">
<button onclick="handleSignIn()" class="btn-primary">Sign In (Owner)</button>
</div>
</div>
</header>
<div id="entry-container" class="section-box" style="display:none;">
<h3>Log New Daily Entry (Owner Only)</h3>
<form id="entry-form" onsubmit="event.preventDefault();handleEntrySubmission();">
<div class="input-grid">
<div class="input-group">
<label for="entry-type">Type</label>
<select id="entry-type" required>
<option value="movie">Movie</option>
<option value="book">Book</option>
</select>
</div>
<div class="input-group">
<label for="entry-title">Title</label>
<input type="text" id="entry-title" required>
</div>
<div class="input-group">
<label for="entry-duration">Duration (Minutes)</label>
<input type="number" id="entry-duration" required min="1">
</div>
<div class="input-group">
<label for="entry-date">Date</label>
<input type="date" id="entry-date" required>
</div>
</div>
<hr style="margin:1.5rem 0;border-color:var(--color-bg-light);">
<div class="input-grid">
<div class="input-group">
<label for="entry-director">Director</label>
<input type="text" id="entry-director">
</div>
<div class="input-group">
<label for="entry-rating">Rating (0-5)</label>
<input type="number" id="entry-rating" step="0.5" min="0" max="5">
</div>
<div class="input-group">
<label for="entry-letterboxd">Letterboxd ID (Optional)</label>
<input type="text" id="entry-letterboxd" placeholder="e.g. 191832">
</div>
<div class="checkbox-group">
<input type="checkbox" id="entry-theater">
<label for="entry-theater" style="margin-bottom:0;">Watched In Theater?</label>
</div>
</div>
<button type="submit" class="btn-primary" style="margin-top:1.5rem;">Submit Entry</button>
</form>
</div>
<div id="director-filter-container" class="section-box" style="padding:1rem 2rem;display:none;">
</div>
<div class="grid-section-wrapper">
<section class="grid-section">
<div class="grid-content-box">
<h2 class="grid-title">GitHub Contributions (Simulated)</h2>
<div id="grid-container-1" class="grid-container">
<div style="padding:2rem;color:#555;">Loading data...</div>
</div>
</div>
</section>
<section class="grid-section hue-shift-minus">
<div class="grid-content-box">
<h2 class="grid-title">Movies Watched in Minutes</h2>
<div id="grid-container-3" class="grid-container">
<div style="padding:2rem;color:#555;">Loading data...</div>
</div>
</div>
</section>
<section class="grid-section hue-shift-plus" style="border-bottom:none;">
<div class="grid-content-box">
<h2 class="grid-title">Books Read in Minutes</h2>
<div id="grid-container-2" class="grid-container">
<div style="padding:2rem;color:#555;">Loading data...</div>
</div>
</div>
</section>
</div>
</div>
</body>
</html>